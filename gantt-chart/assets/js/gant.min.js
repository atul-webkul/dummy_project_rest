!function($){$(function(){var chart=[],link=[],assigned_users=[],chart_link="null"!==gantt_link?eval(gantt_link):"",chart_todo="null"!==gantt_todo?eval(gantt_todo):"",chart_task="null"!==gantt_task?eval(gantt_task):"",assign_to="null"!==assigned_user?eval(assigned_user):"",chart_avatar="null"!==avatars?eval(avatars):"";$.each(assign_to,function(a,b){assigned_users.push(b)}),$.each(chart_link,function(a,b){link.push(b)}),$.each(chart_todo,function(a,b){chart.push(b)}),$.each(chart_task,function(a,b){chart.push(b)}),ganttData={data:chart,links:link},gantt.attachEvent("onBeforeTaskDrag",function(a,b,c){var d=gantt.getTask(a);if("task_list"==d.type)return!1;var e={action:"cpm_check_task_access",_wpnonce:CPM_Vars.nonce,task_id:a,project_id:cproject_id};return function(){var a=null;return $.ajax({async:!1,type:"POST",global:!1,dataType:"json",url:CPM_Vars.ajaxurl,data:e,success:function(b){a=b}}),a}()}),gantt.form_blocks.checkbox={render:function(a){return'<div class="dhx_cal_ltext"><label><input type="checkbox" name="'+a.name+'" value="yes">'+gantts.make_private+"</label></div>"},set_value:function(a,b,c,d){a.checked=!!b},get_value:function(a,b,c){return!!a.checked},focus:function(a){}},gantt.templates.task_date=function(a){var b=new Date(a),c=b.getFullYear(),d=b.toLocaleString("en-us",{month:"long"});return b.getDate()-1+" "+d+" "+c},gantt.config.lightbox.sections=[{name:"title",height:26,map_to:"text",type:"textarea",focus:!0},{name:"description",height:48,map_to:"description",type:"textarea"},{name:"assign_to",height:38,map_to:"assign_to",type:"select",options:assigned_users},{name:"private",type:"private_checkbox",map_to:"task_private"},{name:"task_start",height:72,type:"duration",map_to:"task_start"}],gantt.form_blocks.private_checkbox={render:function(a){return"<div class='dhx_cal_ltext' style='height:25px;'><input type='checkbox' id='gant-private-field'></div>"},set_value:function(a,b,c,d){},get_value:function(a,b,c){return $("#gant-private-field").prop("checked")},focus:function(a){}},gantt.locale.labels.section_task_start=gantts.start_date,gantt.locale.labels.section_assign_to=gantts.assign_to,gantt.locale.labels.section_private=gantts.private,gantt.templates.progress_text=function(a,b,c){return"<span>"+Math.round(100*c.progress)+"% </span>"},gantt.templates.leftside_text=function(a,b,c){return c.duration+" days"},$(".gantt-wrap").dhx_gantt({data:ganttData,drag_links:!0,columns:[{name:"text",label:gantts.task_name,tree:!0,width:160},{name:"assign_to",label:gantts.assign,align:"center",template:function(a){var b="";return a.task_list||$.each(chart_avatar,function(c,d){a.id==d.task_id&&(b=d.avatar)}),b}},{name:"Add task",label:gantts.add_task,align:"center",template:function(a){return!0===a.task_list?'<div class="gantt_add"></div>':""}}],details_on_dblclick:!1}),gantt.attachEvent("onLightboxSave",function(a,b,c){var d=new Date(b.task_start.start_date),e=d.getFullYear(),f=d.getMonth()+1,g=d.getDate(),h=e+"-"+f+"-"+g,i=b.task_start.start_date,j=b.duration-1,k=new Date(i.setDate(i.getDate()+j)),l=k.getFullYear(),m=k.getMonth()+1,n=k.getDate(),o=l+"-"+m+"-"+n;if(""==b.text)return void alert(gantts.message_empty);var p={action:"gantt_new_task",list_id:b.parent,task_start:"on"==gantts.enable_start_date?h:"",task_due:o,task_title:b.text,task_text:b.description,task_assign:[b.assign_to],is_update:c,task_privacy:b.task_private?"yes":"no",_wpnonce:gantts.nonce};return $.post(gantts.ajaxurl,p),!0}),gantt.attachEvent("onAfterTaskUpdate",function(a,b){var c=new Date(b.start_date),d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate(),g=d+"-"+e+"-"+f,c=new Date(b.end_date),d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate(),h=d+"-"+e+"-"+f,i={action:"update_task_date",id:a,start_date:g,end_date:h,progress:b.progress,_wpnonce:gantts.nonce};$.post(gantts.ajaxurl,i)}),gantt.attachEvent("onAfterLinkAdd",function(a,b){var c={action:"update_link",source_id:b.source,target_id:b.target,_wpnonce:gantts.nonce};$.post(gantts.ajaxurl,c)}),gantt.attachEvent("onAfterLinkDelete",function(a,b){var c={action:"delete_link",source_id:b.source,target_id:b.target,_wpnonce:gantts.nonce};$.post(gantts.ajaxurl,c)})})}(jQuery);