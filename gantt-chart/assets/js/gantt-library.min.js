function dtmlXMLLoaderObject(a,b,c,d){return this.xmlDoc="",this.async=void 0===c||c,this.onloadAction=a||null,this.mainObject=b||null,this.waitCall=null,this.rSeed=d||!1,this}function callerFunction(a,b){return this.handler=function(c){return c||(c=window.event),a(c,b),!0},this.handler}function getAbsoluteLeft(a){return getOffset(a).left}function getAbsoluteTop(a){return getOffset(a).top}function getOffsetSum(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}function getOffsetRect(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}function getOffset(a){return a.getBoundingClientRect?getOffsetRect(a):getOffsetSum(a)}function convertStringToBoolean(a){switch("string"==typeof a&&(a=a.toLowerCase()),a){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(a){return-1!=a.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(){return this.catches||(this.catches=[]),this}function dhtmlXHeir(a,b){for(var c in b)"function"==typeof b[c]&&(a[c]=b[c]);return a}function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function dhtmlxDetachEvent(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}function dhtmlxDnD(a,b){b&&(this._settings=b),dhtmlxEventable(this),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(b){this.dragStart(a,b)},this))}function dataProcessor(a){return this.serverProcessor=a,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhtmlxEventable(this),this}window.dhtmlx||(dhtmlx=function(a){for(var b in a)dhtmlx[b]=a[b];return dhtmlx}),dhtmlx.extend_api=function(a,b,c){var d=window[a];d&&(window[a]=function(a){var c;if(a&&"object"==typeof a&&!a.tagName){c=d.apply(this,b._init?b._init(a):arguments);for(var e in dhtmlx)b[e]&&this[b[e]](dhtmlx[e]);for(var e in a)b[e]?this[b[e]](a[e]):0===e.indexOf("on")&&this.attachEvent(e,a[e])}else c=d.apply(this,arguments);return b._patch&&b._patch(this),c||this},window[a].prototype=d.prototype,c&&dhtmlXHeir(window[a].prototype,c))},dhtmlxAjax={get:function(a,b){var c=new dtmlXMLLoaderObject(!0);return c.async=arguments.length<3,c.waitCall=b,c.loadXML(a),c},post:function(a,b,c){var d=new dtmlXMLLoaderObject(!0);return d.async=arguments.length<4,d.waitCall=c,d.loadXML(a,!0,b),d},getSync:function(a){return this.get(a,null,!0)},postSync:function(a,b){return this.post(a,b,null,!0)}},dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(a){var b=!0;return this.check=function(){if(a&&a.onloadAction&&(!a.xmlDoc.readyState||4==a.xmlDoc.readyState)){if(!b)return;b=!1,dtmlXMLLoaderObject.count++,"function"==typeof a.onloadAction&&a.onloadAction(a.mainObject,null,null,null,a),a.waitCall&&(a.waitCall.call(this,a),a.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(a,b){var c;if(this.xmlDoc.responseXML){var d=this.xmlDoc.responseXML.getElementsByTagName(a);if(0===d.length&&-1!=a.indexOf(":"))var d=this.xmlDoc.responseXML.getElementsByTagName(a.split(":")[1]);c=d[0]}else c=this.xmlDoc.documentElement;if(c)return this._retry=!1,c;if(!this._retry&&_isIE){this._retry=!0;var b=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(a,b)}return dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),document.createElement("DIV")},dtmlXMLLoaderObject.prototype.loadXMLString=function(a,b){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(a);else{var c=new DOMParser;this.xmlDoc=c.parseFromString(a,"text/xml")}b||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(a,b,c,d){this.rSeed&&(a+=(-1!=a.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=a,this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),this.xmlDoc.open(b?"POST":"GET",a,this.async),d?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):b&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(c),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;b._tagvalue=a.firstChild?a.firstChild.nodeValue:"";for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c].tagName;d&&(b[d]||(b[d]=[]),b[d].push(this.xmlNodeToJSON(a.childNodes[c])))}return b},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(a){a.onmousedown=null,a.dragStarter=null,a.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(a,b){a.onmousedown=this.preCreateDragCopy,a.dragStarter=b,this.addDragLanding(a,b)},dhtmlDragAndDropObject.prototype.addDragLanding=function(a,b){a.dragLanding=b},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(a){return!a&&!window.event||2!=(a||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(a),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),!(!a||!a.preventDefault)&&(a.preventDefault(),!1)):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(a){a||(a=window.event);var b=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-b.downtime<100)){if(!b.dragNode){if(!b.waitDrag)return b.stopDrag(a,!0);if(b.dragNode=b.dragStartObject._createDragNode(b.dragStartNode,a),!b.dragNode)return b.stopDrag();b.dragNode.onselectstart=function(){return!1},b.gldragNode=b.dragNode,document.body.appendChild(b.dragNode),document.body.onmouseup=b.stopDrag,b.waitDrag=0,b.dragNode.pWindow=window,b.initFrameRoute()}if(b.dragNode.parentNode!=window.document.body&&b.gldragNode){var c=b.gldragNode;b.gldragNode.old&&(c=b.gldragNode.old),c.parentNode.removeChild(c);var d=b.dragNode.pWindow;if(c.pWindow&&c.pWindow.dhtmlDragAndDrop.lastLanding&&c.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(c.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var e=document.createElement("Div");e.innerHTML=b.dragNode.outerHTML,b.dragNode=e.childNodes[0]}else b.dragNode=b.dragNode.cloneNode(!0);b.dragNode.pWindow=window,b.gldragNode.old=b.dragNode,document.body.appendChild(b.dragNode),d.dhtmlDragAndDrop.dragNode=b.dragNode}b.dragNode.style.left=a.clientX+15+(b.fx?-1*b.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",b.dragNode.style.top=a.clientY+3+(b.fy?-1*b.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";var f;f=a.srcElement?a.srcElement:a.target,b.checkLanding(f,a)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(a){if(window.name){for(var b=parent.frames[window.name].frameElement.offsetParent,c=0,d=0;b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;if(parent.dhtmlDragAndDrop){var e=parent.dhtmlDragAndDrop.calculateFramePosition(1);c+=1*e.split("_")[0],d+=1*e.split("_")[1]}if(a)return c+"_"+d;this.fx=c,this.fy=d}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(a,b){a&&a.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=a,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,b.clientX,b.clientY,b),this.lastLanding_scr=_isIE?b.srcElement:b.target):a&&"BODY"!=a.tagName?this.checkLanding(a.parentNode,b):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,b.clientX,b.clientY,b),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(a,b){var c=window.dhtmlDragAndDrop;if(!b){c.stopFrameRoute();var d=c.lastLanding;c.lastLanding=null,d&&d.dragLanding._drag(c.dragStartNode,c.dragStartObject,d,_isIE?event.srcElement:a.target)}c.lastLanding=null,c.dragNode&&c.dragNode.parentNode==document.body&&c.dragNode.parentNode.removeChild(c.dragNode),c.dragNode=0,c.gldragNode=0,c.fx=0,c.fy=0,c.dragStartNode=0,c.dragStartObject=0,document.body.onmouseup=c.tempDOMU,document.body.onmousemove=c.tempDOMM,c.tempDOMU=null,c.tempDOMM=null,c.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(a){a&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var b=0;b<window.frames.length;b++)try{window.frames[b]!=a&&window.frames[b].dhtmlDragAndDrop&&window.frames[b].dhtmlDragAndDrop.stopFrameRoute(window)}catch(a){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(a){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(a,b){a&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=a.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=a.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=a.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=a.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&b&&(!_isFF||1.8>_FFrv)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(a){}for(var c=0;c<window.frames.length;c++)try{window.frames[c]!=a&&window.frames[c].dhtmlDragAndDrop&&window.frames[c].dhtmlDragAndDrop.initFrameRoute(window,!a||b?1:0)}catch(a){}},_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(a,b,c,d){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(a,b);if(_isIE)return b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),c&&b.setProperty("SelectionNamespaces","xmlns:xsl='"+c+"'"),"single"==d?b.selectSingleNode(a):b.selectNodes(a)||new Array(0);var e=b;b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),-1!=b.nodeName.indexOf("document")?e=b:(e=b,b=b.ownerDocument);var f=XPathResult.ANY_TYPE;"single"==d&&(f=XPathResult.FIRST_ORDERED_NODE_TYPE);var g=[],h=b.evaluate(a,e,function(){return c},f,null);if(f==XPathResult.FIRST_ORDERED_NODE_TYPE)return h.singleNodeValue;for(var i=h.iterateNext();i;)g[g.length]=i,i=h.iterateNext();return g},_dhtmlxError.prototype.catchError=function(a,b){this.catches[a]=b},_dhtmlxError.prototype.throwError=function(a,b,c){return this.catches[a]?this.catches[a](a,b,c):this.catches.ALL?this.catches.ALL(a,b,c):(window.alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,dtmlXMLLoaderObject.prototype.doXPathOpera=function(a,b){var c=a.replace(/[\/]+/gi,"/").split("/"),d=null,e=1;if(!c.length)return[];if("."==c[0])d=[b];else{if(""!==c[0])return[];d=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(c[e].replace(/\[[^\]]*\]/g,"")),e++}for(e;e<c.length;e++)d=this._getAllNamedChilds(d,c[e]);return-1!=c[e-1].indexOf("[")&&(d=this._filterXPath(d,c[e-1])),d},dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){for(var c=[],b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),d=0;d<a.length;d++)a[d].getAttribute(b)&&(c[c.length]=a[d]);return c},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=[];_isKHTML&&(b=b.toUpperCase());for(var d=0;d<a.length;d++)for(var e=0;e<a[d].childNodes.length;e++)_isKHTML?a[d].childNodes[e].tagName&&a[d].childNodes[e].tagName.toUpperCase()==b&&(c[c.length]=a[d].childNodes[e]):a[d].childNodes[e].tagName==b&&(c[c.length]=a[d].childNodes[e]);return c},dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(a,b,c){c||(c=this.xslDoc),c.responseXML&&(c=c.responseXML);var d=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+a+"']",c,"http://www.w3.org/1999/XSL/Transform","single");d&&(d.firstChild.nodeValue=b)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(a,b){a||(a=this.xslDoc),a.responseXML&&(a=a.responseXML),b||(b=this.xmlDoc),b.responseXML&&(b=b.responseXML);var c;if(_isIE){c=new ActiveXObject("Msxml2.DOMDocument.3.0");try{b.transformNodeToObject(a,c)}catch(d){c=b.transformNode(a)}}else this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(a)),c=this.XSLProcessor.transformToDocument(b);return c},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(a,b){var c=this.doXSLTransToObject(a,b);return"string"==typeof c?c:this.doSerialization(c)},dtmlXMLLoaderObject.prototype.doSerialization=function(a){return a||(a=this.xmlDoc),a.responseXML&&(a=a.responseXML),_isIE?a.xml:(new XMLSerializer).serializeToString(a)},dhtmlxEventable=function(obj){obj.attachEvent=function(a,b,c){return a="ev_"+a.toLowerCase(),this[a]||(this[a]=new this.eventCatcher(c||this)),a+":"+this[a].addEvent(b)},obj.callEvent=function(a,b){return a="ev_"+a.toLowerCase(),!this[a]||this[a].apply(this,b)},obj.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var a=!0,b=0;b<dhx_catch.length;b++)if(dhx_catch[b]){var c=dhx_catch[b].apply(obj,arguments);a=a&&c}return a};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),!!ev&&dhx_catch.push(ev)-1},z.removeEvent=function(a){dhx_catch[a]=null},z},obj.detachEvent=function(a){if(a){var b=a.split(":");this[b[0]].removeEvent(b[1])}},obj.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&(this.detachEvent(a),this[a]=null)},obj=null},window.dhtmlx||(window.dhtmlx={}),function(){function a(a,b){var d=a.callback;c(!1),a.box.parentNode.removeChild(a.box),m=a.box=null,d&&d(b)}function b(b){if(m){b=b||event;var c=b.which||event.keyCode;return dhtmlx.message.keyboard&&((13==c||32==c)&&a(m,!0),27==c&&a(m,!1)),b.preventDefault&&b.preventDefault(),!(b.cancelBubble=!0)}}function c(a){c.cover||(c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover)),document.body.scrollHeight,c.cover.style.display=a?"inline-block":"none"}function d(a,b){return"<div class='dhtmlx_popup_button dhtmlx_"+a.toLowerCase().replace(/ /g,"_")+"_button' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){n.area||(n.area=document.createElement("DIV"),n.area.className="dhtmlx_message_area",n.area.style[n.position]="5px",document.body.appendChild(n.area)),n.hide(a.id);var b=document.createElement("DIV");return b.innerHTML="<div>"+a.text+"</div>",b.className="dhtmlx-info dhtmlx-"+a.type,b.onclick=function(){n.hide(a.id),a=null},"bottom"==n.position&&n.area.firstChild?n.area.insertBefore(b,n.area.firstChild):n.area.appendChild(b),a.expire>0&&(n.timers[a.id]=window.setTimeout(function(){n.hide(a.id)},a.expire)),n.pull[a.id]=b,b=null,a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type,f.setAttribute("dhxbox",1);var g="";if(b.width&&(f.style.width=b.width),b.height&&(f.style.height=b.height),b.title&&(g+='<div class="dhtmlx_popup_title">'+b.title+"</div>"),g+='<div class="dhtmlx_popup_text"><span>'+(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">',c&&(g+=d(b.ok||"OK",!0)),e&&(g+=d(b.cancel||"Cancel",!1)),b.buttons)for(var h=0;h<b.buttons.length;h++)g+=d(b.buttons[h],h);if(g+="</div>",f.innerHTML=g,b.content){var i=b.content;"string"==typeof i&&(i=document.getElementById(i)),"none"==i.style.display&&(i.style.display=""),f.childNodes[b.title?1:0].appendChild(i)}return f.onclick=function(c){c=c||event;var d=c.target||c.srcElement;if(d.className||(d=d.parentNode),"dhtmlx_popup_button"==d.className.split(" ")[0]){var e=d.getAttribute("result");e="true"==e||"false"!=e&&e,a(b,e)}},b.box=f,(c||e)&&(m=b),f}function g(a,d,e){var g=a.tagName?a:f(a,d,e);a.hidden||c(!0),document.body.appendChild(g);var h=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-g.offsetWidth)/2)),i=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-g.offsetHeight)/2));return g.style.top="top"==a.position?"-3px":i+"px",g.style.left=h+"px",g.onkeydown=b,g.focus(),a.hidden&&dhtmlx.modalbox.hide(g),g}function h(a){return g(a,!0,!1)}function i(a){return g(a,!0,!0)}function j(a){return g(a)}function k(a,b,c){return"object"!=typeof a&&("function"==typeof b&&(c=b,b=""),a={text:a,type:b,callback:c}),a}function l(a,b,c,d){return"object"!=typeof a&&(a={text:a,type:b,expire:c,id:d}),a.id=a.id||n.uid(),a.expire=a.expire||n.expire,a}var m=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",b,!0),dhtmlx.alert=function(){var a=k.apply(this,arguments);return a.type=a.type||"confirm",h(a)},dhtmlx.confirm=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",i(a)},dhtmlx.modalbox=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",j(a)},dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var n=dhtmlx.message=function(a){switch(a=l.apply(this,arguments),a.type=a.type||"info",a.type.split("-")[0]){case"alert":return h(a);case"confirm":return i(a);case"modalbox":return j(a);default:return e(a)}};n.seed=(new Date).valueOf(),n.uid=function(){return n.seed++},n.expire=4e3,n.keyboard=!0,n.position="top",n.pull={},n.timers={},n.hideAll=function(){for(var a in n.pull)n.hide(a)},n.hide=function(a){var b=n.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b),b=null},2e3),b.className+=" hidden",n.timers[a]&&window.clearTimeout(n.timers[a]),delete n.pull[a])}}(),gantt={version:"2.1.1"},dhtmlxEventable=function(obj){obj._silent_mode=!1,obj._silentStart=function(){this._silent_mode=!0},obj._silentEnd=function(){this._silent_mode=!1},obj.attachEvent=function(a,b,c){return a="ev_"+a.toLowerCase(),this[a]||(this[a]=new this._eventCatcher(c||this)),a+":"+this[a].addEvent(b)},obj.callEvent=function(a,b){return!!this._silent_mode||(a="ev_"+a.toLowerCase(),!this[a]||this[a].apply(this,b))},obj.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]},obj._eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var a=!0,b=0;b<dhx_catch.length;b++)if(dhx_catch[b]){var c=dhx_catch[b].apply(obj,arguments);a=a&&c}return a};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),!!ev&&dhx_catch.push(ev)-1},z.removeEvent=function(a){dhx_catch[a]=null},z},obj.detachEvent=function(a){if(a){var b=a.split(":");this[b[0]].removeEvent(b[1])}},obj.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&delete this[a]},obj=null},dhtmlx.copy=function(a){var b,c,d;if(a&&"object"==typeof a){for(d={},c=[Array,Date,Number,String,Boolean],b=0;b<c.length;b++)a instanceof c[b]&&(d=b?new c[b](a):new c[b]);for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&(d[b]=dhtmlx.copy(a[b]))}return d||a},dhtmlx.mixin=function(a,b,c){for(var d in b)(!a[d]||c)&&(a[d]=b[d]);return a},dhtmlx.defined=function(a){return void 0!==a},dhtmlx.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),++this._seed},dhtmlx.bind=function(a,b){return function(){return a.apply(b,arguments)}},gantt._get_position=function(a){var b=0,c=0;if(a.getBoundingClientRect){var d=a.getBoundingClientRect(),e=document.body,f=document.documentElement,g=window.pageYOffset||f.scrollTop||e.scrollTop,h=window.pageXOffset||f.scrollLeft||e.scrollLeft,i=f.clientTop||e.clientTop||0,j=f.clientLeft||e.clientLeft||0;return b=d.top+g-i,c=d.left+h-j,{y:Math.round(b),x:Math.round(c),width:a.offsetWidth,height:a.offsetHeight}}for(;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{y:b,x:c,width:a.offsetWidth,height:a.offsetHeight}},gantt._detectScrollSize=function(){var a=document.createElement("div");a.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;",document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),b},dhtmlxEventable(gantt),gantt._click={},gantt._dbl_click={},gantt._context_menu={},gantt._on_click=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a);if(null!==c){(!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[c,a]))&&gantt.config.select_task&&gantt.selectTask(c)}else gantt.callEvent("onEmptyClick",[a]);gantt._find_ev_handler(a,b,gantt._click,c)},gantt._on_contextmenu=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(b),d=gantt.locate(b,gantt.config.link_attribute),e=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[c,d,a]);return e||a.preventDefault(),e},gantt._find_ev_handler=function(a,b,c,d){for(var e=!0;b&&b.parentNode;){var f=b.className;if(f){f=f.split(" ");for(var g=0;g<f.length;g++)f[g]&&c[f[g]]&&(e=c[f[g]].call(gantt,a,d,b),e=!(void 0!==e&&!0!==e))}b=b.parentNode}return e},gantt._on_dblclick=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a);gantt._find_ev_handler(a,b,gantt._dbl_click,c)&&null!==c&&((!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[c,a]))&&gantt.config.details_on_dblclick&&gantt.showLightbox(c))},gantt._on_mousemove=function(a){if(gantt.checkEvent("onMouseMove")){var b=gantt.locate(a);gantt._last_move_event=a,gantt.callEvent("onMouseMove",[b,a])}},dhtmlxDnD.prototype={dragStart:function(a,b){this.config={obj:a,marker:null,started:!1,pos:this.getPosition(b),sensitivity:4},this._settings&&dhtmlx.mixin(this.config,this._settings,!0);var c=dhtmlx.bind(function(b){return this.dragMove(a,b)},this),d=(dhtmlx.bind(function(b){return this.dragScroll(a,b)},this),dhtmlx.bind(function(a){return!(!dhtmlx.defined(this.config.updates_per_second)||gantt._checkTimeout(this,this.config.updates_per_second))||c(a)},this)),e=dhtmlx.bind(function(){return dhtmlxDetachEvent(document.body,"mousemove",d),dhtmlxDetachEvent(document.body,"mouseup",e),this.dragEnd(a)},this);dhtmlxEvent(document.body,"mousemove",d),dhtmlxEvent(document.body,"mouseup",e),document.body.className+=" gantt_noselect"},dragMove:function(a,b){if(!this.config.marker&&!this.config.started){var c=this.getPosition(b),d=c.x-this.config.pos.x,e=c.y-this.config.pos.y;if(Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2))>this.config.sensitivity){if(this.config.started=!0,this.config.ignore=!1,!1===this.callEvent("onBeforeDragStart",[a,b]))return this.config.ignore=!0,!0;var f=this.config.marker=document.createElement("div");f.className="gantt_drag_marker",f.innerHTML="Dragging object",document.body.appendChild(f),this.callEvent("onAfterDragStart",[a,b])}else this.config.ignore=!0}this.config.ignore||(b.pos=this.getPosition(b),this.config.marker.style.left=b.pos.x+"px",this.config.marker.style.top=b.pos.y+"px",this.callEvent("onDragMove",[a,b]))},dragEnd:function(){this.config.marker&&(this.config.marker.parentNode.removeChild(this.config.marker),this.config.marker=null,this.callEvent("onDragEnd",[])),document.body.className=document.body.className.replace(" gantt_noselect","")},getPosition:function(a){var b=0,c=0;return a=a||window.event,a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}}},gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(a,b){this.close(b)},this),this._click.gantt_open=dhtmlx.bind(function(a,b){this.open(b)},this),this._click.gantt_row=dhtmlx.bind(function(a,b,c){if(null!==b){var d=this.getTaskNode(b),e=Math.max(d.offsetLeft-this.config.task_scroll_offset,0);this.scrollTo(e),this.callEvent("onTaskRowClick",[b,c])}},this),this._click.gantt_grid_head_cell=dhtmlx.bind(function(a,b,c){var d=c.getAttribute("column_id");if(this.callEvent("onGridHeaderClick",[d,a]))if("add"==d)this._click.gantt_add(a,this.config.root_id);else if(this.config.sort){var e=this._sort&&this._sort.direction&&this._sort.name==d?this._sort.direction:"desc";e="desc"==e?"asc":"desc",this._sort={name:d,direction:e},this._render_grid_header(),this.sort(d,"desc"==e)}},this),!this.config.sort&&this.config.order_branch&&this._init_dnd(),this._click.gantt_add=dhtmlx.bind(function(a,b){if(!this.config.readonly){var c=!!b&&this.getTask(b),d="";if(c)d=c.start_date;else{var e=this._order[0];d=e?this.getTask(e).start_date:this.getState().min_date}c&&(c.$open=!0);var f={text:gantt.locale.labels.new_task,start_date:this.templates.xml_format(d),duration:1,progress:0,parent:b};f.id=dhtmlx.uid(),this.callEvent("onTaskCreated",[f]),this.config.details_on_create?(f.$new=!0,this._pull[f.id]=this._init_task(f),this._add_branch(f),f.$level=this._item_level(f),this.selectTask(f.id),this.refreshData(),this.showLightbox(f.id)):(this.addTask(f),this.showTask(f.id),this.selectTask(f.id))}},this)},gantt._render_grid=function(){this._is_grid_visible()&&(this._calc_grid_width(),this._render_grid_header())},gantt._calc_grid_width=function(){if(this.config.autofit){for(var a=this.config.columns,b=0,c=[],d=[],e=0;e<a.length;e++){var f=parseInt(a[e].width,10);window.isNaN(f)&&(f=50,c.push(e)),d[e]=f,b+=f}var g=this._get_grid_width()-b;if(c.length>0?c.length:d.length>0&&d.length,c.length>0)for(var h=g/(c.length?c.length:1),e=0;e<c.length;e++){var i=c[e];d[i]+=h}else for(var h=g/(d.length?d.length:1),e=0;e<d.length;e++)d[e]+=h;for(var e=0;e<d.length;e++)a[e].width=d[e]}},gantt._render_grid_header=function(){for(var a=this.config.columns,b=[],c=0,d=this.locale.labels,e=this.config.scale_height-2,f=0;f<a.length;f++){var g=f==a.length-1,h=a[f];g&&this._get_grid_width()>c+h.width&&(h.width=this._get_grid_width()-c),c+=h.width;var i=this._sort&&h.name==this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"",j=["gantt_grid_head_cell","gantt_grid_head_"+h.name,g?"gantt_last_cell":"",this.templates.grid_header_class(h.name,h)].join(" "),k="width:"+(h.width-(g?1:0))+"px;",l=h.label||d["column_"+h.name];l=l||"";var m="<div class='"+j+"' style='"+k+"' column_id='"+h.name+"'>"+l+i+"</div>";b.push(m)}this.$grid_scale.style.height=this.config.scale_height-1+"px",this.$grid_scale.style.lineHeight=e+"px",this.$grid_scale.style.width=c-1+"px",this.$grid_scale.innerHTML=b.join("")},gantt._render_grid_item=function(a){if(!gantt._is_grid_visible())return null;for(var b=this.config.columns,c=[],d=0;d<b.length;d++){var e,f,g=d==b.length-1,h=b[d];"add"==h.name&&d==b.length-1?f="<div class='gantt_add'></div>":(f=h.template?h.template(a):a[h.name],f instanceof Date&&(f=this.templates.date_grid(f)),f="<div class='gantt_tree_content'>"+f+"</div>");var i="gantt_cell"+(g?" gantt_last_cell":""),j="";if(h.tree){for(var k=0;k<a.$level;k++)j+=this.templates.grid_indent(a);this._branches[a.id]&&this._branches[a.id].length>0?(j+=this.templates.grid_open(a),j+=this.templates.grid_folder(a)):(j+=this.templates.grid_blank(a),j+=this.templates.grid_file(a))}var l="width:"+(h.width-(g?1:0))+"px;";dhtmlx.defined(h.align)&&(l+="text-align:"+h.align+";"),e="<div class='"+i+"' style='"+l+"'>"+j+f+"</div>",c.push(e)}var i=a.$index%2==0?"":" odd";if(i+=a.$transparent?" gantt_transparent":"",this.templates.grid_row_class){var m=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);m&&(i+=" "+m)}this.getState().selected_task==a.id&&(i+=" gantt_selected");var n=document.createElement("div");return n.className="gantt_row"+i,n.style.height=this.config.row_height+"px",n.style.lineHeight=gantt.config.row_height+"px",n.setAttribute(this.config.task_attribute,a.id),n.innerHTML=c.join(""),n},gantt.open=function(a){gantt._set_item_state(a,!0),this.callEvent("onTaskOpened",[a])},gantt.close=function(a){gantt._set_item_state(a,!1),this.callEvent("onTaskClosed",[a])},gantt._set_item_state=function(a,b){a&&this._pull[a]&&(this._pull[a].$open=b,this.refreshData())},gantt._is_grid_visible=function(){return this.config.grid_width&&this.config.show_grid},gantt._get_grid_width=function(){return this._is_grid_visible()?this._is_chart_visible()?this.config.grid_width:this._x:0},gantt.getTaskIndex=function(a){for(var b=this._branches[this.getTask(a).parent],c=0;c<b.length;c++)if(b[c]==a)return c;return-1},gantt.getGlobalTaskIndex=function(a){for(var b=this._order,c=0;c<b.length;c++)if(b[c]==a)return c;return-1},gantt.moveTask=function(a,b,c){var d=arguments[3];if(d){if(d===a)return;c=this.getTask(d).parent,b=this.getTaskIndex(d)}c=c||this.config.root_id;var e=this.getTask(a),f=(this._branches[e.parent],this._branches[c]);if(-1==b&&(b=f.length+1),e.parent==c){var g=this.getTaskIndex(a);if(g==b)return;b>g&&b--}this._replace_branch_child(e.parent,a),
f=this._branches[c],f[b]?f=f.slice(0,b).concat([a]).concat(f.slice(b)):f.push(a),e.parent=c,this._branches[c]=f,this.refreshData()},gantt._init_dnd=function(){var a=new dhtmlxDnD(this.$grid_data,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){if(!this._locateHTML(b))return!1;this.hideQuickInfo&&this._hideQuickInfo();var c=this.locate(b);return!!this.callEvent("onRowDragStart",[c,b.target||b.srcElement,b])&&void 0},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);a.config.marker.innerHTML=d.outerHTML,a.config.id=this.locate(c);var e=this.getTask(a.config.id);e.$open=!1,e.$transparent=!0,this.refreshData()},this)),a.lastTaskOfLevel=function(a){for(var b=gantt._order,c=gantt._pull,d=null,e=0,f=b.length;f>e;e++)c[b[e]].$level==a&&(d=c[b[e]]);return d?d.id:null},a.attachEvent("onDragMove",dhtmlx.bind(function(b,c){var d=a.config,e=this._get_position(this.$grid_data),f=e.x+10,g=c.pos.y-10;g<e.y&&(g=e.y),g>e.y+this.$grid_data.offsetHeight-this.config.row_height&&(g=e.y+this.$grid_data.offsetHeight-this.config.row_height),d.marker.style.left=f+"px",d.marker.style.top=g+"px";var h=document.elementFromPoint(e.x-document.body.scrollLeft+1,g-document.body.scrollTop),i=this.locate(h),j=this.getTask(a.config.id);if(this.isTaskExists(i)||(i=a.lastTaskOfLevel(j.$level))==a.config.id&&(i=null),this.isTaskExists(i)){var k=gantt._get_position(h),l=this.getTask(i);if(k.y+h.offsetHeight/2<g){var m=this.getGlobalTaskIndex(l.id),n=this._pull[this._order[m+1+(l.id==j.id?1:0)]];if(n){if(n.id==j.id)return;l=n}else if(n=this._pull[this._order[m]],n.$level==j.$level)return this.moveTask(j.id,-1,n.parent),void(d.target="next:"+n.id)}if(l.$level==j.$level&&j.id!=l.id)this.moveTask(j.id,0,0,l.id),d.target=l.id;else{if(j.id==l.id)return;var m=this.getGlobalTaskIndex(l.id),o=this._pull[this._order[m-1]];o&&o.$level==j.$level&&j.id!=o.id&&(this.moveTask(j.id,-1,o.parent),d.target="next:"+o.id)}}return!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(){this.getTask(a.config.id).$transparent=!1,this.refreshData(),this.callEvent("onRowDragEnd",[a.config.id,a.config.target])},this))},gantt._scale_helpers={getSum:function(a,b,c){void 0===c&&(c=a.length-1),void 0===b&&(b=0);for(var d=0,e=b;c>=e;e++)d+=a[e];return d},setSumWidth:function(a,b,c,d){var e=b.width;void 0===d&&(d=e.length-1),void 0===c&&(c=0);var f=d-c+1;if(!(c>e.length-1||0>=f||d>e.length-1)){var g=this.getSum(e,c,d),h=a-g;this.adjustSize(h,e,c,d),this.adjustSize(-h,e,d+1),b.full_width=this.getSum(e)}},splitSize:function(a,b){for(var c=[],d=0;b>d;d++)c[d]=0;return this.adjustSize(a,c),c},adjustSize:function(a,b,c,d){c||(c=0),void 0===d&&(d=b.length-1);for(var e=d-c+1,f=this.getSum(b,c,d),g=0,h=c;d>=h;h++){var i=Math.floor(a*(f?b[h]/f:1/e));f-=b[h],a-=i,e--,b[h]+=i,g+=i}b[b.length-1]+=a},sortScales:function(a){function b(a,b){var c=new Date(1970,0,1);return gantt.date.add(c,b,a)-c}a.sort(function(a,c){return b(a.unit,a.step)<b(c.unit,c.step)?1:-1})},primaryScale:function(){return gantt._init_template("date_scale"),{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,css:gantt.templates.scale_cell_class}},prepareConfigs:function(a,b,c,d){for(var e=this.splitSize(d,a.length),f=c,g=[],h=a.length-1;h>=0;h--){var i=h==a.length-1,j=this.initScaleConfig(a[h]);i&&this.processIgnores(j),this.initColSizes(j,b,f,e[h]),this.limitVisibleRange(j),i&&(f=j.full_width),g.unshift(j)}for(var h=0;h<g.length-1;h++)this.alineScaleColumns(g[g.length-1],g[h]);return g},_ignore_time_config:function(a){return!!this.config.skip_off_time&&!this.isWorkTime(a)},processIgnores:function(a){var b=a.count;if(a.ignore_x={},gantt.ignore_time||gantt.config.skip_off_time){var c=gantt.ignore_time||function(){return!1};b=0;for(var d=0;d<a.trace_x.length;d++)c.call(gantt,a.trace_x[d])||this._ignore_time_config.call(gantt,a.trace_x[d])?(a.ignore_x[a.trace_x[d].valueOf()]=!0,a.ignored_colls=!0):b++}a.display_count=b},initColSizes:function(a,b,c,d){var e=c;a.height=d;var f=void 0===a.display_count?a.count:a.display_count;f||(f=1),a.col_width=Math.floor(e/f),b&&a.col_width<b&&(a.col_width=b,e=a.col_width*f),a.width=[];for(var g=a.ignore_x||{},h=0;h<a.trace_x.length;h++)a.width[h]=g[a.trace_x[h].valueOf()]||a.display_count==a.count?0:1;this.adjustSize(e-this.getSum(a.width),a.width),a.full_width=this.getSum(a.width)},initScaleConfig:function(a){var b=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:0,width:[],trace_x:[]},a);return this.eachColumn(a.unit,a.step,function(a){b.count++,b.trace_x.push(new Date(a))}),b},iterateScales:function(a,b,c,d,e){for(var f=b.trace_x,g=a.trace_x,h=c||0,i=d||g.length-1,j=0,k=1;k<f.length;k++)for(var l=h;i>=l;l++)+g[l]!=+f[k]||(e&&e.apply(this,[j,k,h,l]),h=l,j=k)},alineScaleColumns:function(a,b,c,d){this.iterateScales(a,b,c,d,function(c,d,e,f){var g=this.getSum(a.width,e,f-1);this.getSum(b.width,c,d-1)!=g&&this.setSumWidth(g,b,c,d-1)})},eachColumn:function(a,b,c){var d=new Date(gantt._min_date),e=new Date(gantt._max_date);gantt.date[a+"_start"]&&(d=gantt.date[a+"_start"](d));for(var f=new Date(d);+e>+f;)c.call(this,new Date(f)),f=gantt.date.add(f,b,a)},limitVisibleRange:function(a){var b=a.trace_x,c=a.width.length-1,d=0;if(+b[0]<+gantt._min_date&&0!=c){var e=Math.floor(a.width[0]*((b[1]-gantt._min_date)/(b[1]-b[0])));d+=a.width[0]-e,a.width[0]=e,b[0]=new Date(gantt._min_date)}var f=b.length-1,g=b[f],h=gantt.date.add(g,a.step,a.unit);if(+h>+gantt._max_date&&f>0){var e=a.width[f]-Math.floor(a.width[f]*((h-gantt._max_date)/(h-g)));d+=a.width[f]-e,a.width[f]=e}if(d){for(var i=this.getSum(a.width),j=0,k=0;k<a.width.length;k++){var l=Math.floor(d*(a.width[k]/i));a.width[k]+=l,j+=l}this.adjustSize(d-j,a.width)}}},gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var a=gantt.config.drag_mode;this.set_actions();var b={before_start:"onBeforeTaskDrag",before_finish:"onBeforeTaskChanged",after_finish:"onAfterTaskDrag"};for(var c in this._events)for(var d in a)this._events[c][d]=b[c];this._handlers[a.move]=this._move,this._handlers[a.resize]=this._resize,this._handlers[a.progress]=this._resize_progress},set_actions:function(){var a=gantt.$task_data;dhtmlxEvent(a,"mousemove",dhtmlx.bind(function(a){this.on_mouse_move(a||event)},this)),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(a){this.on_mouse_down(a||event)},this)),dhtmlxEvent(a,"mouseup",dhtmlx.bind(function(a){this.on_mouse_up(a||event)},this))},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start_x:null,start_y:null,obj:null,left:null}},_resize:function(a,b,c){var d=gantt.config,e=this._drag_task_coords(a,c);c.left?(a.start_date=gantt._date_from_pos(e.start+b),a.start_date||(a.start_date=new Date(gantt.getState().min_date))):(a.end_date=gantt._date_from_pos(e.end+b),a.end_date||(a.end_date=new Date(gantt.getState().max_date))),a.end_date-a.start_date<d.min_duration&&(c.left?a.start_date=gantt.calculateEndDate(a.end_date,-1):a.end_date=gantt.calculateEndDate(a.start_date,1)),gantt._init_task_timing(a)},_resize_progress:function(a,b,c){var d=this._drag_task_coords(a,c),e=Math.max(0,c.pos.x-d.start);a.progress=Math.min(1,e/(d.end-d.start))},_move:function(a,b,c){var d=this._drag_task_coords(a,c),e=gantt._date_from_pos(d.start+b),f=gantt._date_from_pos(d.end+b);e?f?(a.start_date=e,a.end_date=f):(a.end_date=new Date(gantt.getState().max_date),a.start_date=gantt._date_from_pos(gantt.posFromDate(a.end_date)-(d.end-d.start))):(a.start_date=new Date(gantt.getState().min_date),a.end_date=gantt._date_from_pos(gantt.posFromDate(a.start_date)+(d.end-d.start)))},_drag_task_coords:function(a,b){return{start:b.obj_s_x=b.obj_s_x||gantt.posFromDate(a.start_date),end:b.obj_e_x=b.obj_e_x||gantt.posFromDate(a.end_date)}},on_mouse_move:function(a){if(this.drag.start_drag&&this._start_dnd(a),this.drag.mode){if(!gantt._checkTimeout(this,40))return;this._update_on_move(a)}},_update_on_move:function(a){var b=this.drag;if(b.mode){var c=gantt._get_mouse_pos(a);if(b.pos&&b.pos.x==c.x)return;b.pos=c;var d=gantt._date_from_pos(c.x);if(!d||isNaN(d.getTime()))return;var e=c.x-b.start_x,f=gantt.getTask(b.id);if(this._handlers[b.mode]){var g=dhtmlx.mixin({},f),h=dhtmlx.mixin({},f);this._handlers[b.mode].apply(this,[h,e,b]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id,!0),gantt.callEvent("onTaskDrag",[f.id,b.mode,h,g,a]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id),gantt.refreshTask(b.id)}}},on_mouse_down:function(a,b){if(2!=a.button&&!gantt.config.readonly&&!this.drag.mode){this.clear_drag_state(),b=b||a.target||a.srcElement;var c=gantt._trim(b.className||"");if(!c||!this._get_drag_mode(c))return b.parentNode?this.on_mouse_down(a,b.parentNode):void 0;var d=this._get_drag_mode(c);if(d)if(d.mode&&d.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+d.mode]){var e=gantt.locate(b),f=dhtmlx.copy(gantt.getTask(e)||{});if(gantt._is_flex_task(f)&&d.mode!=gantt.config.drag_mode.progress)return void this.clear_drag_state();d.id=e;var g=gantt._get_mouse_pos(a);d.start_x=g.x,d.start_y=g.y,d.obj=f,this.drag.start_drag=d}else this.clear_drag_state();else if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[c.split(" ")[0]])&&b.parentNode)return this.on_mouse_down(a,b.parentNode)}},_fix_dnd_scale_time:function(a,b){var c=gantt._tasks.unit,d=gantt._tasks.step;gantt.config.round_dnd_dates||(c="minute",d=gantt.config.time_step),b.mode==gantt.config.drag_mode.resize?b.left?a.start_date=gantt._get_closest_date({date:a.start_date,unit:c,step:d}):a.end_date=gantt._get_closest_date({date:a.end_date,unit:c,step:d}):b.mode==gantt.config.drag_mode.move&&(a.start_date=gantt._get_closest_date({date:a.start_date,unit:c,step:d}),a.end_date=gantt.calculateEndDate(a.start_date,a.duration,gantt.config.duration_unit))},_fix_working_times:function(a,b){gantt.config.work_time&&gantt.config.correct_work_time&&(b.mode==gantt.config.drag_mode.resize?b.left?a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}):a.end_date=gantt.getClosestWorkTime({date:a.end_date,dir:"past"}):b.mode==gantt.config.drag_mode.move&&(gantt.isWorkTime(a.start_date)?gantt.isWorkTime(new Date(+a.end_date-1))||(a.end_date=gantt.getClosestWorkTime({date:a.end_date,dir:"past"}),a.start_date=gantt.calculateEndDate(a.end_date,-1*a.duration)):(a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}),a.end_date=gantt.calculateEndDate(a.start_date,a.duration))))},on_mouse_up:function(a){var b=this.drag;if(b.mode&&b.id){var c=gantt.getTask(b.id);if(gantt.config.work_time&&gantt.config.correct_work_time&&this._fix_working_times(c,b),this._fix_dnd_scale_time(c,b),gantt._init_task_timing(c),this._fireEvent("before_finish",b.mode,[b.id,b.mode,dhtmlx.copy(b.obj),a])){var d=b.id;gantt._init_task_timing(c),gantt.updateTask(c.id),this._fireEvent("after_finish",b.mode,[d,b.mode,a]),this.clear_drag_state()}else b.obj._dhx_changed=!1,dhtmlx.mixin(c,b.obj,!0),gantt.updateTask(c.id)}this.clear_drag_state()},_get_drag_mode:function(a){var b=gantt.config.drag_mode,c=(a||"").split(" "),d=c[0],e={mode:null,left:null};switch(d){case"gantt_task_line":case"gantt_task_content":e.mode=b.move;break;case"gantt_task_drag":e.mode=b.resize,e.left=!(!c[1]||-1===c[1].indexOf("left",c[1].length-"left".length));break;case"gantt_task_progress_drag":e.mode=b.progress;break;case"gantt_link_control":case"gantt_link_point":e.mode=b.ignore;break;default:e=null}return e},_start_dnd:function(a){var b=this.drag=this.drag.start_drag;delete b.start_drag;var c=gantt.config,d=b.id;c["drag_"+b.mode]&&gantt.callEvent("onBeforeDrag",[d,b.mode,a])&&this._fireEvent("before_start",b.mode,[d,b.mode,a])?delete b.start_drag:this.clear_drag_state()},_fireEvent:function(a,b,c){dhtmlx.assert(this._events[a],"Invalid stage:{"+a+"}");var d=this._events[a][b];return dhtmlx.assert(d,"Unknown after drop mode:{"+b+"}"),dhtmlx.assert(c,"Invalid event arguments"),!gantt.checkEvent(d)||gantt.callEvent(d,c)}},gantt._render_link=function(a){var b=this.getLink(a);gantt._linkRenderer.render_item(b,this.$task_links)},gantt._get_link_type=function(a,b){var c=null;return a&&b?c=gantt.config.links.start_to_start:!a&&b?c=gantt.config.links.finish_to_start:a||b?a&&!b&&(c=gantt.config.links.start_to_finish):c=gantt.config.links.finish_to_finish,c},gantt.isLinkAllowed=function(a,b,c,d){var e=null;if(!(e="object"==typeof a?a:{source:a,target:b,type:this._get_link_type(c,d)}))return!1;if(!(e.source&&e.target&&e.type))return!1;if(e.source==e.target)return!1;var f=!0;return this.checkEvent("onLinkValidation")&&(f=this.callEvent("onLinkValidation",[e])),f},gantt._render_link_element=function(a){var b=this._path_builder.get_points(a),c=gantt._drawer,d=c.get_lines(b),e=document.createElement("div"),f="gantt_task_link",g=this.templates.link_class?this.templates.link_class(a):"";g&&(f+=" "+g),e.className=f,e.setAttribute(gantt.config.link_attribute,a.id);for(var h=0;h<d.length;h++)h==d.length-1&&(d[h].size-=gantt.config.link_arrow_size),e.appendChild(c.render_line(d[h],d[h+1]));var i=d[d.length-1].direction,j=gantt._render_link_arrow(b[b.length-1],i);return e.appendChild(j),e},gantt._render_link_arrow=function(a,b){var c=document.createElement("div"),d=gantt._drawer,e=a.y,f=a.x,g=gantt.config.link_arrow_size,h=gantt.config.row_height,i="gantt_link_arrow gantt_link_arrow_"+b;switch(b){case d.dirs.right:e-=(g-h)/2,f-=g;break;case d.dirs.left:e-=(g-h)/2;break;case d.dirs.up:f-=(g-h)/2;break;case d.dirs.down:e-=g,f-=(g-h)/2}return c.style.cssText=["top:"+e+"px","left:"+f+"px"].join(";"),c.className=i,c},gantt._drawer={current_pos:null,dirs:{left:"left",right:"right",up:"up",down:"down"},path:[],clear:function(){this.current_pos=null,this.path=[]},point:function(a){this.current_pos=dhtmlx.copy(a)},get_lines:function(a){this.clear(),this.point(a[0]);for(var b=1;b<a.length;b++)this.line_to(a[b]);return this.get_path()},line_to:function(a){var b=dhtmlx.copy(a),c=this.current_pos,d=this._get_line(c,b);this.path.push(d),this.current_pos=b},get_path:function(){return this.path},get_wrapper_sizes:function(a){var b,c=gantt.config.link_wrapper_width,d=(gantt.config.link_line_width,a.y+(gantt.config.row_height-c)/2);switch(a.direction){case this.dirs.left:b={top:d,height:c,lineHeight:c,left:a.x-a.size-c/2,width:a.size+c};break;case this.dirs.right:b={top:d,lineHeight:c,height:c,left:a.x-c/2,width:a.size+c};break;case this.dirs.up:b={top:d-a.size,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c};break;case this.dirs.down:b={top:d,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c}}return b},get_line_sizes:function(a){var b,c=gantt.config.link_line_width,d=gantt.config.link_wrapper_width,e=a.size+c;switch(a.direction){case this.dirs.left:case this.dirs.right:b={height:c,width:e,marginTop:(d-c)/2,marginLeft:(d-c)/2};break;case this.dirs.up:case this.dirs.down:b={height:e,width:c,marginTop:(d-c)/2,marginLeft:(d-c)/2}}return b},render_line:function(a){var b=this.get_wrapper_sizes(a),c=document.createElement("div");c.style.cssText=["top:"+b.top+"px","left:"+b.left+"px","height:"+b.height+"px","width:"+b.width+"px"].join(";"),c.className="gantt_line_wrapper";var d=this.get_line_sizes(a),e=document.createElement("div");return e.style.cssText=["height:"+d.height+"px","width:"+d.width+"px","margin-top:"+d.marginTop+"px","margin-left:"+d.marginLeft+"px"].join(";"),e.className="gantt_link_line_"+a.direction,c.appendChild(e),c},_get_line:function(a,b){var c=this.get_direction(a,b),d={x:a.x,y:a.y,direction:this.get_direction(a,b)};return d.size=Math.abs(c==this.dirs.left||c==this.dirs.right?a.x-b.x:a.y-b.y),d},get_direction:function(a,b){return b.x<a.x?this.dirs.left:b.x>a.x?this.dirs.right:b.y>a.y?this.dirs.down:this.dirs.up}},gantt._y_from_ind=function(a){return a*gantt.config.row_height},gantt._path_builder={path:[],clear:function(){this.path=[]},current:function(){return this.path[this.path.length-1]},point:function(a){return a?(this.path.push(dhtmlx.copy(a)),a):this.current()},point_to:function(a,b,c){c=c?{x:c.x,y:c.y}:dhtmlx.copy(this.point());var d=gantt._drawer.dirs;switch(a){case d.left:c.x-=b;break;case d.right:c.x+=b;break;case d.up:c.y-=b;break;case d.down:c.y+=b}return this.point(c)},get_points:function(a){var b=this.get_endpoint(a),c=gantt.config,d=b.e_y-b.y,e=b.e_x-b.x,f=gantt._drawer.dirs;this.clear(),this.point({x:b.x,y:b.y});var g=2*c.link_arrow_size,h=b.e_x>b.x;if(a.type==gantt.config.links.start_to_start)this.point_to(f.left,g),h?(this.point_to(f.down,d),this.point_to(f.right,e)):(this.point_to(f.right,e),this.point_to(f.down,d)),this.point_to(f.right,g);else if(a.type==gantt.config.links.finish_to_start)if(h=b.e_x>b.x+2*g,this.point_to(f.right,g),h)e-=g,this.point_to(f.down,d),this.point_to(f.right,e);else{e-=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.right,g)}else if(a.type==gantt.config.links.finish_to_finish)this.point_to(f.right,g),h?(this.point_to(f.right,e),this.point_to(f.down,d)):(this.point_to(f.down,d),this.point_to(f.right,e)),this.point_to(f.left,g);else if(a.type==gantt.config.links.start_to_finish)if(h=b.e_x>b.x-2*g,this.point_to(f.left,g),h){e+=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.left,g)}else e+=g,this.point_to(f.down,d),this.point_to(f.right,e);return this.path},get_endpoint:function(a){var b=gantt.config.links,c=!1,d=!1;a.type==b.start_to_start?c=d=!0:a.type==b.finish_to_finish?c=d=!1:a.type==b.finish_to_start?(c=!1,d=!0):a.type==b.start_to_finish?(c=!0,d=!1):dhtmlx.assert(!1,"Invalid link type");var e=gantt._get_task_visible_pos(gantt._pull[a.source],c),f=gantt._get_task_visible_pos(gantt._pull[a.target],d);return{x:e.x,e_x:f.x,y:e.y,e_y:f.y}}},gantt._init_links_dnd=function(){function a(a,b,c){var d=gantt._get_task_pos(a,!!b);return d.y+=gantt._get_task_height()/2,c=c||0,d.x+=(b?-1:1)*c,d}function b(a){var b=d(),c=["gantt_link_tooltip"];b.from&&b.to&&c.push(gantt.isLinkAllowed(b.from,b.to,b.from_start,b.to_start)?"gantt_allowed_link":"gantt_invalid_link");var e=gantt.templates.drag_link_class(b.from,b.from_start,b.to,b.to_start);e&&c.push(e);var f="<div class='"+e+"'>"+gantt.templates.drag_link(b.from,b.from_start,b.to,b.to_start)+"</div>";a.innerHTML=f}function c(a,b){a.style.left=b.x+5+"px",a.style.top=b.y+5+"px"}function d(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start}}function e(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=null,gantt._link_target_task_start=!0}function f(a,b,c,e){var f=i(),j=d(),k=["gantt_link_direction"];gantt.templates.link_direction_class&&k.push(gantt.templates.link_direction_class(j.from,j.from_start,j.to,j.to_start));var l=Math.sqrt(Math.pow(c-a,2)+Math.pow(e-b,2));if(l=Math.max(0,l-3)){f.className=k.join(" ");var m=(e-b)/(c-a),n=Math.atan(m);2==h(a,c,b,e)?n+=Math.PI:3==h(a,c,b,e)&&(n-=Math.PI);var o=Math.sin(n),p=Math.cos(n),q=Math.round(b),r=Math.round(a),s=["-webkit-transform: rotate("+n+"rad)","-moz-transform: rotate("+n+"rad)","-ms-transform: rotate("+n+"rad)","-o-transform: rotate("+n+"rad)","transform: rotate("+n+"rad)","width:"+Math.round(l)+"px"];if(-1!=window.navigator.userAgent.indexOf("MSIE 8.0")){s.push('-ms-filter: "'+g(o,p)+'"');var t=Math.abs(Math.round(a-c)),u=Math.abs(Math.round(e-b));switch(h(a,c,b,e)){case 1:q-=u;break;case 2:r-=t,q-=u;break;case 3:r-=t}}s.push("top:"+q+"px"),s.push("left:"+r+"px"),f.style.cssText=s.join(";")}}function g(a,b){return"progid:DXImageTransform.Microsoft.Matrix(M11 = "+b+",M12 = -"+a+",M21 = "+a+",M22 = "+b+",SizingMethod = 'auto expand')"}function h(a,b,c,d){return b>=a?c>=d?1:4:c>=d?2:3}function i(){return k._direction||(k._direction=document.createElement("div"),gantt.$task_links.appendChild(k._direction)),k._direction}function j(){k._direction&&(k._direction.parentNode&&k._direction.parentNode.removeChild(k._direction),k._direction=null)}var k=new dhtmlxDnD(this.$task_bars,{sensitivity:0,updates_per_second:60}),l="gantt_link_control";k.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){if(gantt.config.readonly)return!1;var d=c.target||c.srcElement;if(e(),gantt.getState().drag_id)return!1;if(gantt._locate_css(d,"gantt_link_point")){gantt._locate_css(d,"task_left")&&(gantt._link_source_task_start=!0);var f=gantt._link_source_task=this.locate(c),g=gantt.getTask(f),h=0;return g.type==gantt.config.types.milestone&&(h=(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2),this._dir_start=a(g,!!gantt._link_source_task_start,h),!0}return!1},this)),k.attachEvent("onAfterDragStart",dhtmlx.bind(function(){b(k.config.marker)},this)),k.attachEvent("onDragMove",dhtmlx.bind(function(d,e){var g=k.config,h=k.getPosition(e);c(g.marker,h);var i=gantt._is_link_drop_area(e),j=gantt._link_target_task,m=gantt._link_landing,n=gantt._link_target_task_start,o=gantt.locate(e),p=!0;if(i&&(p=!gantt._locate_css(e,"task_right"),i=!!o),gantt._link_target_task=o,gantt._link_landing=i,gantt._link_target_task_start=p,i){var q=gantt.getTask(o),r=gantt._locate_css(e,l),s=0;r&&(s=Math.floor(r.offsetWidth/2)),this._dir_end=a(q,!!gantt._link_target_task_start,s)}else this._dir_end=gantt._get_mouse_pos(e);var t=!(m==i&&j==o&&n==p);return t&&(j&&gantt.refreshTask(j,!1),o&&gantt.refreshTask(o,!1)),t&&b(g.marker),f(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y),!0},this)),k.attachEvent("onDragEnd",dhtmlx.bind(function(){var a=d();if(a.from&&a.to&&a.from!=a.to){var b=gantt._get_link_type(a.from_start,a.to_start);b&&gantt.addLink({source:a.from,target:a.to,type:b})}e(),a.from&&gantt.refreshTask(a.from,!1),a.to&&gantt.refreshTask(a.to,!1),j()},this)),gantt._is_link_drop_area=function(a){return!!gantt._locate_css(a,l)}},gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start}},gantt._init_tasks=function(){function a(a,b,c,d){for(var e=0;e<a.length;e++)a[e].change_id(b,c),a[e].render_item(d)}this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}},this._click.gantt_task_link=dhtmlx.bind(function(a){var b=this.locate(a,gantt.config.link_attribute);b&&this.callEvent("onLinkClick",[b,a])},this),this._dbl_click.gantt_task_link=dhtmlx.bind(function(a,b){var b=this.locate(a,gantt.config.link_attribute);this._delete_link_handler(b,a)},this),this._dbl_click.gantt_link_point=dhtmlx.bind(function(a,b,c){var b=this.locate(a),d=this.getTask(b),e=null;return c.parentNode&&c.parentNode.className&&(e=c.parentNode.className.indexOf("_left")>-1?d.$target[0]:d.$source[0]),e&&this._delete_link_handler(e,a),!1},this),this._tasks_dnd.init(),this._init_links_dnd();var b=this._create_filter("_filter_task","_is_grid_visible"),c=this._create_filter("_filter_task","_is_chart_visible"),d=this._create_filter("_filter_link","_is_chart_visible");this._taskRenderer=gantt._task_renderer("line",this._render_task_element,this.$task_bars,c),this._linkRenderer=gantt._task_renderer("links",this._render_link_element,this.$task_links,d),this._gridRenderer=gantt._task_renderer("grid_items",this._render_grid_item,this.$grid_data,b),this._bgRenderer=gantt._task_renderer("bg_lines",this._render_bg_line,this.$task_bg,c),this.attachEvent("onTaskIdChange",function(b,c){a(this._get_task_renderers(),b,c,this.getTask(c))}),this.attachEvent("onLinkIdChange",function(b,c){a(this._get_link_renderers(),b,c,this.getLink(c))})},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&!1!==gantt[f].apply(gantt,[b.id,b]))}return c}},gantt._is_chart_visible=function(){return!!this.config.show_chart},gantt._filter_task=function(a,b){var c=null,d=null;return!(this.config.start_date&&this.config.end_date&&(c=this.config.start_date.valueOf(),d=this.config.end_date.valueOf(),+b.start_date>d||+b.end_date<+c))},gantt._filter_link=function(a,b){return!!(this.config.show_links&&gantt.isTaskVisible(b.source)&&gantt.isTaskVisible(b.target))&&this.callEvent("onBeforeLinkDisplay",[a,b])},gantt._get_task_renderers=function(){return[this._taskRenderer,this._gridRenderer,this._bgRenderer]},gantt._get_link_renderers=function(){return[this._linkRenderer]},gantt._delete_link_handler=function(a,b){if(a&&this.callEvent("onLinkDblClick",[a,b])){if(this.config.readonly)return;var c=gantt.locale.labels.link+" "+this.templates.link_description(this.getLink(a))+" "+gantt.locale.labels.confirm_link_deleting;window.setTimeout(function(){gantt._dhtmlx_confirm(c,"",function(){gantt.deleteLink(a)})},gantt.config.touch?300:1)}},gantt.getTaskNode=function(a){return this._taskRenderer.rendered[a]},gantt.getLinkNode=function(a){return this._linkRenderer.rendered[a]},gantt._get_tasks_data=function(){for(var a=[],b=0;b<this._order.length;b++){var c=this._pull[this._order[b]];c.$index=b,this._update_parents(c.id,!0),a.push(c)}return a},gantt._get_links_data=function(){var a=[];for(var b in this._lpull)a.push(this._lpull[b]);return a},gantt._render_data=function(){this._update_layout_sizes();for(var a=this._get_tasks_data(),b=this._get_task_renderers(),c=0;c<b.length;c++)b[c].render_items(a);var d=gantt._get_links_data();b=this._get_link_renderers();for(var c=0;c<b.length;c++)b[c].render_items(d)},gantt._update_layout_sizes=function(){var a=this._tasks;if(a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.width=a.full_width+"px",this._is_grid_visible()){for(var b=this.config.columns,c=0,d=0;d<b.length;d++)c+=b[d].width;this.$grid_data.style.width=Math.max(c-1,0)+"px"}},gantt._init_tasks_range=function(){var a=this.config.scale_unit;if(this.config.start_date&&this.config.end_date)return this._min_date=this.date[a+"_start"](new Date(this.config.start_date)),void(this._max_date=this.date[a+"_start"](new Date(this.config.end_date)));var b=this._get_tasks_data(),c=this._init_task({id:this.config.root_id});b.push(c);var d=-1/0,e=1/0;this.eachTask(function(a){a.end_date&&+a.end_date>+d&&(d=new Date(a.end_date))},this.config.root_id),this.eachTask(function(a){a.start_date&&+a.start_date<+e&&(e=new Date(a.start_date))},this.config.root_id),this._min_date=e,this._max_date=d,d&&d!=-1/0||(this._min_date=new Date,this._max_date=new Date(this._min_date)),this._min_date=this.date[a+"_start"](this._min_date),+this._min_date==+e&&(this._min_date=this.date.add(this.date[a+"_start"](this._min_date),-1,a)),this._max_date=this.date[a+"_start"](this._max_date),this._max_date=this.date.add(this._max_date,1,a)},gantt._prepare_scale_html=function(a){var b=[],c=null,d=null,e=null;(a.template||a.date)&&(d=a.template||this.date.date_to_str(a.date)),e=a.css||gantt.templates.scale_cell_class;for(var f=0;f<a.count;f++){c=new Date(a.trace_x[f]);var g=d.call(this,c),h=a.width[f],i="",j="",k="";if(h){i="width:"+h+"px;",k="gantt_scale_cell"+(f==a.count-1?" gantt_last_cell":""),(j=e.call(this,c))&&(k+=" "+j);var l="<div class='"+k+"' style='"+i+"'>"+g+"</div>";b.push(l)}}return b.join("")},gantt._render_tasks_scales=function(){this._init_tasks_range(),this._scroll_resize(),this._set_sizes();var a="",b=0,c=0,d=0;if(this._is_chart_visible()){var e=this._scale_helpers,f=[e.primaryScale()].concat(this.config.subscales);d=this.config.scale_height-1,e.sortScales(f);for(var g=this._get_resize_options(),h=g.x?0:this.$task.offsetWidth,i=e.prepareConfigs(f,this.config.min_column_width,h,d),j=this._tasks=i[i.length-1],k=[],l=this.templates.scale_row_class,m=0;m<i.length;m++){var n="gantt_scale_line",o=l(i[m]);o&&(n+=" "+o),k.push('<div class="'+n+'" style="height:'+i[m].height+"px;line-height:"+i[m].height+'px">'+this._prepare_scale_html(i[m])+"</div>")}a=k.join(""),b=j.full_width+this.$scroll_ver.offsetWidth+"px",c=j.full_width+"px",d+="px"}this.$task.style.display=this._is_chart_visible()?"":"none",this.$task_scale.style.height=d,this.$task_data.style.width=this.$task_scale.style.width=b,this.$task_links.style.width=this.$task_bars.style.width=c,this.$task_scale.innerHTML=a},gantt._render_bg_line=function(a){var b=gantt._tasks,c=b.count,d=[];if(gantt.config.show_task_cells)for(var e=0;c>e;e++){var f=b.width[e],g="",h="";if(f>0){g="width:"+f+"px;",h="gantt_task_cell"+(e==c-1?" gantt_last_cell":""),(k=this.templates.task_cell_class(a,b.trace_x[e]))&&(h+=" "+k);var i="<div class='"+h+"' style='"+g+"'></div>";d.push(i)}}var j=a.$index%2!=0,k=gantt.templates.task_row_class(a.start_date,a.end_date,a),l="gantt_task_row"+(j?" odd":"")+(k?" "+k:"");this.getState().selected_task==a.id&&(l+=" gantt_selected");var m=document.createElement("div");return m.className=l,m.style.height=gantt.config.row_height+"px",m.setAttribute(this.config.task_attribute,a.id),m.innerHTML=d.join(""),m},gantt._adjust_scales=function(){if(this.config.fit_tasks){var a=+this._min_date,b=+this._max_date;if(this._init_tasks_range(),+this._min_date!=a||+this._max_date!=b)return this.render(),this.callEvent("onScaleAdjusted",[]),!0}return!1},gantt.refreshTask=function(a,b){var c=this._get_task_renderers(),d=this.getTask(a);if(d&&this.isTaskVisible(a))for(var e=0;e<c.length;e++)c[e].render_item(d);else for(var e=0;e<c.length;e++)c[e].remove_item(a);if(void 0===b||b){for(var d=this.getTask(a),e=0;e<d.$source.length;e++)gantt.refreshLink(d.$source[e]);for(var e=0;e<d.$target.length;e++)gantt.refreshLink(d.$target[e])}},gantt.refreshLink=function(a){this.isLinkExists(a)?gantt._render_link(a):gantt._linkRenderer.remove_item(a)},gantt._combine_item_class=function(a,b,c){var d=[a];b&&d.push(b);var e=gantt.getState(),f=this.getTask(c);this._get_safe_type(f.type)==this.config.types.milestone&&d.push("gantt_milestone"),this._get_safe_type(f.type)==this.config.types.project&&d.push("gantt_project"),this._is_flex_task(f)&&d.push("gantt_dependent_task"),this.config.select_task&&c==e.selected_task&&d.push("gantt_selected"),c==e.drag_id&&d.push("gantt_drag_"+e.drag_mode);var g=gantt._get_link_state();if(g.link_source_id==c&&d.push("gantt_link_source"),g.link_target_id==c&&d.push("gantt_link_target"),g.link_landing_area&&g.link_target_id&&g.link_source_id&&g.link_target_id!=g.link_source_id){var h=g.link_source_id,i=g.link_source_start,j=g.link_target_start,k=gantt.isLinkAllowed(h,c,i,j),l="";l=k?j?"link_start_allow":"link_finish_allow":j?"link_start_deny":"link_finish_deny",d.push(l)}return d.join(" ")},gantt._render_pair=function(a,b,c,d){var e=gantt.getState();+c.end_date<=+e.max_date&&a.appendChild(d(b+" task_right")),+c.start_date>=+e.min_date&&a.appendChild(d(b+" task_left"))},gantt._get_task_height=function(){var a=this.config.task_height;return"full"==a&&(a=this.config.row_height-5),a=Math.min(a,this.config.row_height),Math.max(a,0)},gantt._get_milestone_width=function(){return this._get_task_height()},gantt._get_visible_milestone_width=function(){var a=gantt._get_task_height();return Math.sqrt(2*a*a)},gantt._get_task_width=function(a){return Math.round(this._get_task_pos(a,!1).x-this._get_task_pos(a,!0).x)},gantt._render_task_element=function(a){var b=this._get_task_pos(a),c=this.config,d=this._get_task_height(),e=Math.floor((this.config.row_height-d)/2);a.type==c.types.milestone&&c.link_line_width>1&&(e+=1);var f=document.createElement("div"),g=gantt._get_task_width(a),h=this._get_safe_type(a.type);f.setAttribute(this.config.task_attribute,a.id),f.appendChild(gantt._render_task_content(a,g)),
f.className=this._combine_item_class("gantt_task_line",this.templates.task_class(a.start_date,a.end_date,a),a.id),f.style.cssText=["left:"+b.x+"px","top:"+(e+b.y)+"px","height:"+d+"px","line-height:"+d+"px","width:"+g+"px"].join(";");var i=this._render_leftside_content(a);return i&&f.appendChild(i),i=this._render_rightside_content(a),i&&f.appendChild(i),c.show_progress&&h!=this.config.types.milestone&&this._render_task_progress(a,f,g),this.config.readonly||(c.drag_resize&&!this._is_flex_task(a)&&h!=this.config.types.milestone&&gantt._render_pair(f,"gantt_task_drag",a,function(a){var b=document.createElement("div");return b.className=a,b}),c.drag_links&&gantt._render_pair(f,"gantt_link_control",a,function(a){var b=document.createElement("div");b.className=a,b.style.cssText=["height:"+d+"px","line-height:"+d+"px"].join(";");var c=document.createElement("div");return c.className="gantt_link_point",b.appendChild(c),b})),f},gantt._render_side_content=function(a,b,c){if(!b)return null;var d=b(a.start_date,a.end_date,a);if(!d)return null;var e=document.createElement("div");return e.className="gantt_side_content "+c,e.innerHTML=d,e},gantt._render_leftside_content=function(a){var b="gantt_left "+gantt._get_link_crossing_css(!0,a);return gantt._render_side_content(a,this.templates.leftside_text,b)},gantt._render_rightside_content=function(a){var b="gantt_right "+gantt._get_link_crossing_css(!1,a);return gantt._render_side_content(a,this.templates.rightside_text,b)},gantt._get_conditions=function(a){return a?{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]}:{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]}},gantt._get_link_crossing_css=function(a,b){var c=gantt._get_conditions(a);for(var d in c)for(var e=b[d],f=0;f<e.length;f++)for(var g=gantt.getLink(e[f]),h=0;h<c[d].length;h++)if(g.type==c[d][h])return"gantt_link_crossing";return""},gantt._render_task_content=function(a){var b=document.createElement("div");return this._get_safe_type(a.type)!=this.config.types.milestone&&(b.innerHTML=this.templates.task_text(a.start_date,a.end_date,a)),b.className="gantt_task_content",b},gantt._render_task_progress=function(a,b,c){var d=1*a.progress||0;c=Math.max(c-2,0);var e=document.createElement("div"),f=Math.round(c*d);if(f=Math.min(c,f),e.style.width=f+"px",e.className="gantt_task_progress",e.innerHTML=this.templates.progress_text(a.start_date,a.end_date,a),b.appendChild(e),this.config.drag_progress&&!gantt.config.readonly){var g=document.createElement("div");g.style.left=f+"px",g.className="gantt_task_progress_drag",e.appendChild(g),b.appendChild(g)}},gantt._get_line=function(a){return{second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3,year:31536e3}[a]||0},gantt._date_from_pos=function(a){var b=this._tasks;if(0>a||a>b.full_width)return null;for(var c=0,d=0;d+b.width[c]<a;)d+=b.width[c],c++;var e=(a-d)/b.width[c],f=gantt._get_coll_duration(b,b.trace_x[c]);return new Date(b.trace_x[c].valueOf()+Math.round(e*f))},gantt.posFromDate=function(a){var b=gantt._day_index_by_date(a);dhtmlx.assert(b>=0,"Invalid day index");for(var c=Math.floor(b),d=b%1,e=0,f=1;c>=f;f++)e+=gantt._tasks.width[f-1];return d&&(e+=c<gantt._tasks.width.length?gantt._tasks.width[c]*(d%1):1),e},gantt._day_index_by_date=function(a){var b=new Date(a),c=gantt._tasks.trace_x,d=gantt._tasks.ignore_x;if(+b<=this._min_date)return 0;if(+b>=this._max_date)return c.length;for(var e=0;e<c.length-1&&(!(+b<c[e+1])||d[+c[e+1]]);e++);return e+(a-c[e])/gantt._get_coll_duration(gantt._tasks,c[e])},gantt._get_coll_duration=function(a,b){return gantt.date.add(b,a.step,a.unit)-b},gantt._get_x_pos=function(a,b){b=!1!==b,gantt.posFromDate(b?a.start_date:a.end_date)},gantt._get_task_coord=function(a,b,c){b=!1!==b,c=c||0;var d=a.type==this.config.types.milestone,e=this.posFromDate(b||d?a.start_date:a.end_date),f=this._y_from_ind(this._get_visible_order(a.id));return d&&(b?e-=c:e+=c),{x:e,y:f}},gantt._get_task_pos=function(a,b){b=!1!==b;var c=gantt._get_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._get_task_visible_pos=function(a,b){b=!1!==b;var c=gantt._get_visible_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._correct_shift=function(a,b){return a-=6e4*(new Date(gantt._min_date).getTimezoneOffset()-new Date(a).getTimezoneOffset())*(b?-1:1)},gantt._get_mouse_pos=function(a){if(a.pageX||a.pageY)var b={x:a.pageX,y:a.pageY};var c=_isIE?document.documentElement:document.body,b={x:a.clientX+c.scrollLeft-c.clientLeft,y:a.clientY+c.scrollTop-c.clientTop},d=gantt._get_position(gantt.$task_data);return b.x=b.x-d.x+gantt.$task_data.scrollLeft,b.y=b.y-d.y+gantt.$task_data.scrollTop,b},gantt._task_renderer=function(a,b,c,d){return this._task_area_pulls||(this._task_area_pulls={}),this._task_area_renderers||(this._task_area_renderers={}),this._task_area_renderers[a]?this._task_area_renderers[a]:(b||dhtmlx.assert(!1,"Invalid renderer call"),this._task_area_renderers[a]={render_item:function(e,f){var g=gantt._task_area_pulls[a];if(f=f||c,d&&!d(e))return void this.remove_item(e.id);var h=b.call(gantt,e);h&&(g[e.id]?this.replace_item(e.id,h):(g[e.id]=h,f.appendChild(h)))},render_items:function(b,d){this.rendered=gantt._task_area_pulls[a]={},d=d||c,d.innerHTML="";for(var e=document.createDocumentFragment(),f=0,g=b.length;g>f;f++)this.render_item(b[f],e);d.appendChild(e)},replace_item:function(a,b){var c=this.rendered[a];c&&c.parentNode&&c.parentNode.replaceChild(b,c),this.rendered[a]=b},remove_item:function(a){var b=this.rendered[a];b&&b.parentNode&&b.parentNode.removeChild(b),delete this.rendered[a]},change_id:function(a,b){this.rendered[b]=this.rendered[a],delete this.rendered[a]},rendered:this._task_area_pulls[a],node:c},this._task_area_renderers[a])},gantt._pull={},gantt._branches={},gantt._order=[],gantt._lpull={},gantt.load=function(a,b,c){dhtmlx.assert(arguments.length,"Invalid load arguments"),this.callEvent("onLoadStart",[]);var d="json",e=null;arguments.length>=3?(d=b,e=c):"string"==typeof arguments[1]?d=arguments[1]:"function"==typeof arguments[1]&&(e=arguments[1]),dhtmlxAjax.get(a,dhtmlx.bind(function(a){this.on_load(a,d),"function"==typeof e&&e.call(this)},this))},gantt.parse=function(a,b){this.on_load({xmlDoc:{responseText:a}},b)},gantt.serialize=function(a){return a=a||"json",this[a].serialize()},gantt.on_load=function(a,b){b||(b="json"),dhtmlx.assert(this[b],"Invalid data type:'"+b+"'");var c=a.xmlDoc.responseText,d=this[b].parse(c,a);this._process_loading(d),this.callEvent("onLoadEnd",[])},gantt._process_loading=function(a){a.collections&&this._load_collections(a.collections);for(var b=a.data,c=0;c<b.length;c++){var d=b[c];this._init_task(d),this.callEvent("onTaskLoading",[d])&&(this._pull[d.id]=d,this._add_branch(d))}this._sync_order();for(var c in this._pull)this._pull[c].$level=this._item_level(this._pull[c]);this._init_links(a.links||(a.collections?a.collections.links:[]))},gantt._init_links=function(a){if(a)for(var b=0;b<a.length;b++)if(a[b]){var c=this._init_link(a[b]);this._lpull[c.id]=c}this._sync_links()},gantt._load_collections=function(a){var b=!1;for(var c in a)if(a.hasOwnProperty(c)){b=!0;var d=a[c],e=this.serverList[c];if(!e)continue;e.splice(0,e.length);for(var f=0;f<d.length;f++){var g=d[f],h=dhtmlx.copy(g);h.key=h.value;for(var i in g)if(g.hasOwnProperty(i)){if("value"==i||"label"==i)continue;h[i]=g[i]}e.push(h)}}b&&this.callEvent("onOptionsLoad",[])},gantt._sync_order=function(){this._order=[],this._sync_order_item({parent:this.config.root_id,$open:!0,$ignore:!0,id:this.config.root_id}),this._scroll_resize(),this._set_sizes()},gantt.attachEvent("onBeforeTaskDisplay",function(a,b){return!b.$ignore}),gantt._sync_order_item=function(a){if(a.id&&this._filter_task(a.id,a)&&this.callEvent("onBeforeTaskDisplay",[a.id,a])&&this._order.push(a.id),a.$open){var b=this._branches[a.id];if(b)for(var c=0;c<b.length;c++)this._sync_order_item(this._pull[b[c]])}},gantt._get_visible_order=function(a){dhtmlx.assert(a,"Invalid argument");for(var b=this._order,c=0,d=b.length;d>c;c++)if(b[c]==a)return c;return-1},gantt.eachTask=function(a,b,c){b=b||this.config.root_id,c=c||this;var d=this._branches[b];if(d)for(var e=0;e<d.length;e++){var f=this._pull[d[e]];a.call(c,f),this._branches[f.id]&&this.eachTask(a,f.id,c)}},gantt.json={parse:function(data){return dhtmlx.assert(data,"Invalid data"),"string"==typeof data&&(window.JSON?data=JSON.parse(data):(gantt._temp=eval("("+data+")"),data=gantt._temp||{},gantt._temp=null)),data.dhx_security&&(dhtmlx.security_key=data.dhx_security),data},_copyLink:function(a){var b={};for(var c in a)b[c]=a[c];return b},_copyObject:function(a){var b={};for(var c in a)"$"!=c.charAt(0)&&(b[c]=a[c]);return b.start_date=gantt.templates.xml_format(b.start_date),b.end_date&&(b.end_date=gantt.templates.xml_format(b.end_date)),b},serialize:function(){var a=[],b=[];gantt.eachTask(function(b){a.push(this._copyObject(b))},gantt.config.root_id,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return{data:a,links:b}}},gantt.xml={_xmlNodeToJSON:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=a.attributes[d].value;if(!b){for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];1==e.nodeType&&(c[e.tagName]=e.firstChild?e.firstChild.nodeValue:"")}c.text||(c.text=a.firstChild?a.firstChild.nodeValue:"")}return c},_getCollections:function(a){for(var b={},c=a.doXPath("//coll_options"),d=0;d<c.length;d++)for(var e=c[d].getAttribute("for"),f=b[e]=[],g=a.doXPath(".//item",c[d]),h=0;h<g.length;h++){for(var i=g[h],j=i.attributes,k={key:g[h].getAttribute("value"),label:g[h].getAttribute("label")},l=0;l<j.length;l++){var m=j[l];"value"!=m.nodeName&&"label"!=m.nodeName&&(k[m.nodeName]=m.nodeValue)}f.push(k)}return b},_getXML:function(a,b,c){c=c||"data",b.getXMLTopNode||(b=new dtmlXMLLoaderObject(function(){}),b.loadXMLString(a));var d=b.getXMLTopNode(c);if(d.tagName!=c)throw"Invalid XML data";var e=d.getAttribute("dhx_security");return e&&(dhtmlx.security_key=e),b},parse:function(a,b){b=this._getXML(a,b);for(var c={},d=c.data=[],e=b.doXPath("//task"),f=0;f<e.length;f++)d[f]=this._xmlNodeToJSON(e[f]);return c.collections=this._getCollections(b),c},_copyLink:function(a){return"<item id='"+a.id+"' source='"+a.source+"' target='"+a.target+"' type='"+a.type+"' />"},_copyObject:function(a){var b=gantt.templates.xml_format(a.start_date),c=gantt.templates.xml_format(a.end_date);return"<task id='"+a.id+"' parent='"+(a.parent||"")+"' start_date='"+b+"' duration='"+a.duration+"' open='"+!!a.open+"' progress='"+a.progress+"' end_date='"+c+"'><![CDATA["+a.text+"]]></task>"},serialize:function(){var a=[],b=[];gantt.eachTask(function(b){a.push(this._copyObject(b))},this.config.root_id,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return"<data>"+a.join("")+"<coll_options for='links'>"+b.join("")+"</coll_options></data>"}},gantt.oldxml={parse:function(a,b){b=gantt.xml._getXML(a,b,"projects");for(var c={collections:{links:[]}},d=c.data=[],e=b.doXPath("//task"),f=0;f<e.length;f++){d[f]=gantt.xml._xmlNodeToJSON(e[f]);var g=e[f].parentNode;d[f].parent="project"==g.tagName?"project-"+g.getAttribute("id"):g.parentNode.getAttribute("id")}e=b.doXPath("//project");for(var f=0;f<e.length;f++){var h=gantt.xml._xmlNodeToJSON(e[f],!0);h.id="project-"+h.id,d.push(h)}for(var f=0;f<d.length;f++){var h=d[f];h.start_date=h.startdate||h.est,h.end_date=h.enddate,h.text=h.name,h.duration=h.duration/8,h.open=1,h.duration||h.end_date||(h.duration=1),h.predecessortasks&&c.collections.links.push({target:h.id,source:h.predecessortasks,type:gantt.config.links.finish_to_start})}return c},serialize:function(){dhtmlx.message("Serialization to 'old XML' is not implemented")}},gantt.serverList=function(a,b){return b?this.serverList[a]=b.slice(0):this.serverList[a]||(this.serverList[a]=[]),this.serverList[a]},gantt._working_time_helper={units:["year","month","week","day","hour","minute"],hours:[8,17],dates:{0:!1,6:!1},_get_unit_order:function(a){for(var b=0,c=this.units.length;c>b;b++)if(this.units[b]==a)return b;dhtmlx.assert(!1,"Incorrect duration unit")},_timestamp:function(a){var b=null;return a.day||0===a.day?b=a.day:a.date&&(b=gantt.date.date_part(new Date(a.date)).valueOf()),b},set_time:function(a){var b=void 0===a.hours||a.hours,c=this._timestamp(a);null!==c?this.dates[c]=b:this.hours=b},unset_time:function(a){if(a){var b=this._timestamp(a);null!==b&&delete this.dates[b]}else this.hours=[]},is_working_unit:function(a,b,c){return!gantt.config.work_time||(void 0===c&&(c=this._get_unit_order(b)),void 0!==c&&(!(c&&!this.is_working_unit(a,this.units[c-1],c-1))&&(!this["is_work_"+b]||this["is_work_"+b](a))))},is_work_day:function(a){var b=this.get_working_hours(a);return b instanceof Array&&b.length>0},is_work_hour:function(a){for(var b=this.get_working_hours(a),c=a.getHours(),d=0;d<b.length;d+=2){if(void 0===b[d+1])return b[d]==c;if(c>=b[d]&&c<b[d+1])return!0}return!1},get_working_hours:function(a){var b=this._timestamp({date:a}),c=!0;return void 0!==this.dates[b]?c=this.dates[b]:void 0!==this.dates[a.getDay()]&&(c=this.dates[a.getDay()]),!0===c?this.hours:c||[]},get_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1,g=0;e.valueOf()<f.valueOf();)this.is_working_unit(e,c)&&g++,e=gantt.date.add(e,d,c);return g},add_worktime:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=0,d=d||1,b=1*b;b>f;){var g=gantt.date.add(e,d,c);this.is_working_unit(d>0?e:g,c)&&f++,e=g}return e},get_closest_worktime:function(a){if(this.is_working_unit(a.date,a.unit))return a.date;var b=a.unit,c=gantt.date[b+"_start"](a.date),d=new Date(c),e=new Date(c),f=!0,g=0,h="any"==a.dir||!a.dir,i=1;for("past"==a.dir&&(i=-1);!this.is_working_unit(c,b);)if(h&&(c=f?d:e,i*=-1),c=gantt.date.add(c,i,b),h&&(f?d=c:e=c),f=!f,++g>3e3)return dhtmlx.assert(!1,"Invalid working time check"),!1;return(c==e||"past"==a.dir)&&(c=gantt.date.add(c,1,b)),c}},gantt.getTask=function(a){return dhtmlx.assert(this._pull[a]),this._pull[a]},gantt.getTaskByTime=function(a,b){var c=this._pull,d=[];if(a||b){a=+a||-1/0,b=+b||1/0;for(var e in c){var f=c[e];+f.start_date<b&&+f.end_date>a&&d.push(f)}}else for(var e in c)d.push(c[e]);return d},gantt.isTaskExists=function(a){return dhtmlx.defined(this._pull[a])},gantt.isTaskVisible=function(a){if(!this._pull[a])return!1;if(!(+this._pull[a].start_date<+this._max_date&&+this._pull[a].end_date>+this._min_date))return!1;for(var b=0,c=this._order.length;c>b;b++)if(this._order[b]==a)return!0;return!1},gantt.updateTask=function(a,b){return dhtmlx.defined(b)||(b=this.getTask(a)),!1!==this.callEvent("onBeforeTaskUpdate",[a,b])&&(this._pull[b.id]=b,this._is_parent_sync(b)||this._resync_parent(b),this._update_parents(b.id),this.refreshTask(b.id),this.callEvent("onAfterTaskUpdate",[a,b]),this._sync_order(),void this._adjust_scales())},gantt._add_branch=function(a){this._branches[a.parent]||(this._branches[a.parent]=[]);for(var b=this._branches[a.parent],c=!1,d=0,e=b.length;e>d;d++)if(b[d]==a.id){c=!0;break}c||b.push(a.id),this._sync_parent(a),this._sync_order()},gantt._move_branch=function(a,b,c){a.parent=c,this._sync_parent(a),this._replace_branch_child(b,a.id),c?this._add_branch(a):delete this._branches[a.id],a.$level=this._item_level(a),this._sync_order()},gantt._resync_parent=function(a){this._move_branch(a,a.$rendered_parent,a.parent)},gantt._sync_parent=function(a){a.$rendered_parent=a.parent},gantt._is_parent_sync=function(a){return a.$rendered_parent==a.parent},gantt._replace_branch_child=function(a,b,c){var d=this._branches[a];if(d){for(var e=[],f=0;f<d.length;f++)d[f]!=b?e.push(d[f]):c&&e.push(c);this._branches[a]=e}this._sync_order()},gantt.addTask=function(a,b){return dhtmlx.defined(b)||(b=a.parent||0),dhtmlx.defined(this._pull[b])||(b=0),a.parent=b,a=this._init_task(a),!1!==this.callEvent("onBeforeTaskAdd",[a.id,a])&&(this._pull[a.id]=a,this._add_branch(a),this.refreshData(),this.callEvent("onAfterTaskAdd",[a.id,a]),this._adjust_scales(),a.id)},gantt.deleteTask=function(a){return this._deleteTask(a)},gantt._deleteTask=function(a,b){var c=this.getTask(a);if(!b&&!1===this.callEvent("onBeforeTaskDelete",[a,c]))return!1;!b&&this._dp&&this._dp.setUpdateMode("off");var d=this._branches[c.id]||[];this._update_flags(a,!1);for(var e=0;e<d.length;e++)this._silentStart(),this._deleteTask(d[e],!0),this._dp&&(this._dp._ganttMode="tasks",this._dp.setUpdated(d[e],!0,"deleted")),this._silentEnd();for(!b&&this._dp&&this._dp.setUpdateMode("cell");c.$source.length>0;)this.deleteLink(c.$source[0]);for(;c.$target.length>0;)this.deleteLink(c.$target[0]);return delete this._pull[a],this._move_branch(c,c.parent,null),b||(this.callEvent("onAfterTaskDelete",[a,c]),this.refreshData()),!0},gantt.clearAll=function(){this._pull={},this._branches={},this._order=[],this._order_full=[],this._lpull={},this.refreshData(),this.callEvent("onClear",[])},gantt._update_flags=function(a,b){this._lightbox_id==a&&(this._lightbox_id=b),this._selected_task==a&&(this._selected_task=b),this._tasks_dnd.drag&&this._tasks_dnd.drag.id==a&&(this._tasks_dnd.drag.id=b)},gantt.changeTaskId=function(a,b){var c=this._pull[b]=this._pull[a];this._pull[b].id=b,delete this._pull[a];for(var d in this._pull)this._pull[d].parent==a&&(this._pull[d].parent=b);this._update_flags(a,b),this._replace_branch_child(c.parent,a,b),this.callEvent("onTaskIdChange",[a,b])},gantt._get_duration_unit=function(){return 1e3*gantt._get_line(this.config.duration_unit)||this.config.duration_unit},gantt._get_safe_type=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return a;return gantt.config.types.task},gantt._get_type_name=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return b;return"task"},gantt.getWorkHours=function(a){return this._working_time_helper.get_working_hours(a)},gantt.setWorkTime=function(a){this._working_time_helper.set_time(a)},gantt.isWorkTime=function(a,b){return this._working_time_helper.is_working_unit(a,b||this.config.duration_unit)},gantt.getClosestWorkTime=function(a){var b=this._working_time_helper;return a instanceof Date&&(a={date:a}),a.dir=a.dir||"any",a.unit=a.unit||this.config.duration_unit,b.get_closest_worktime(a)},gantt.calculateDuration=function(a,b){return this._working_time_helper.get_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt.calculateEndDate=function(a,b){var c=this._working_time_helper,d=b>=0?1:-1;return c.add_worktime(a,Math.abs(b),this.config.duration_unit,d*this.config.duration_step)},gantt._init_task=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a.start_date&&(a.start_date=gantt.date.parseDate(a.start_date,"xml_date")),a.end_date&&(a.end_date=gantt.date.parseDate(a.end_date,"xml_date")),a.start_date&&!a.end_date&&a.duration&&(a.end_date=this.calculateEndDate(a.start_date,a.duration)),gantt.config.work_time&&gantt.config.correct_work_time&&(a.start_date&&(a.start_date=gantt.getClosestWorkTime(a.start_date)),a.end_date&&(a.end_date=gantt.getClosestWorkTime(a.end_date))),gantt._init_task_timing(a),a.$source=[],a.$target=[],a.parent=a.parent||this.config.root_id,a.$open=!!dhtmlx.defined(a.open)&&a.open,a.$level=this._item_level(a),a},gantt._init_task_timing=function(a){void 0===a.$rendered_type?a.$rendered_type=a.type:a.$rendered_type!=a.type&&(delete a.$no_end,delete a.$no_start,a.$rendered_type=a.type),void 0!==a.$no_end&&void 0!==a.$no_start||a.type==this.config.types.milestone||(a.type==this.config.types.project?a.$no_end=a.$no_start=!0:(a.$no_end=!(a.end_date||a.duration),a.$no_start=!a.start_date)),a.type==this.config.types.milestone&&(a.end_date=a.start_date),a.start_date&&a.end_date&&(a.duration=this.calculateDuration(a.start_date,a.end_date)),a.duration=a.duration||0},gantt._is_flex_task=function(a){return!(!a.$no_end&&!a.$no_start)},gantt._update_parents=function(a,b){if(a){for(var c=this.getTask(a);!c.$no_end&&!c.$no_start&&c.parent&&this.isTaskExists(c.parent);)c=this.getTask(c.parent);if(c.$no_end){var d=0;this.eachTask(function(a){a.end_date&&+a.end_date>+d&&(d=new Date(a.end_date))},c.id),d&&(c.end_date=d)}if(c.$no_start){var e=1/0;this.eachTask(function(a){a.start_date&&+a.start_date<+e&&(e=new Date(a.start_date))},c.id),1/0!=e&&(c.start_date=e)}(c.$no_end||c.$no_start)&&(this._init_task_timing(c),b||this.refreshTask(c.id,!0)),c.parent&&this.isTaskExists(c.parent)&&this._update_parents(c.parent,b)}},gantt.isChildOf=function(a,b){if(!this.isTaskExists(a))return!1;if(b===this.config.root_id)return this.isTaskExists(a);for(var c=this.getTask(a);c&&this.isTaskExists(c.parent);)if((c=this.getTask(c.parent))&&c.id==b)return!0;return!1},gantt._get_closest_date=function(a){for(var b=a.date,c=a.step,d=a.unit,e=gantt.date[d+"_start"](new Date(this._min_date));+b>+e;)e=gantt.date.add(e,c,d);var f=gantt.date.add(e,-1*c,d);return a.dir&&"future"==a.dir?e:a.dir&&"past"==a.dir?f:Math.abs(b-f)<Math.abs(e-b)?f:e},gantt.attachEvent("onBeforeTaskUpdate",function(a,b){return gantt._init_task_timing(b),!0}),gantt.attachEvent("onBeforeTaskAdd",function(a,b){return gantt._init_task_timing(b),!0}),gantt._item_level=function(a){for(var b=0;a.parent&&dhtmlx.defined(this._pull[a.parent]);)a=this._pull[a.parent],b++;return b},gantt.sort=function(a,b,c){var d=!arguments[3];dhtmlx.defined(c)||(c=this.config.root_id),dhtmlx.defined(a)||(a="order");var e="string"==typeof a?function(c,d){var e=c[a]>d[a];return b&&(e=!e),e?1:-1}:a,f=this._branches[c];if(f){for(var g=[],h=f.length-1;h>=0;h--)g[h]=this._pull[f[h]];g.sort(e);for(var h=0;h<g.length;h++)f[h]=g[h].id,this.sort(a,b,f[h],!0)}d&&this.refreshData()},gantt.getNext=function(a){for(var b=0;b<this._order.length-1;b++)if(this._order[b]==a)return this._order[b+1];return null},gantt.getPrev=function(a){for(var b=1;b<this._order.length;b++)if(this._order[b]==a)return this._order[b-1];return null},gantt._dp_init=function(a){a.setTransactionMode("POST",!0),a.serverProcessor+=(-1!=a.serverProcessor.indexOf("?")?"&":"?")+"editing=true",a._serverProcessor=a.serverProcessor,a.styles={updated:"gantt_updated",inserted:"gantt_inserted",deleted:"gantt_deleted",invalid:"gantt_invalid",error:"gantt_error",clear:""},a._methods=["_row_style","setCellTextStyle","_change_id","_delete_task"],this.attachEvent("onAfterTaskAdd",function(b){a._ganttMode="tasks",a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterTaskUpdate",function(b){a._ganttMode="tasks",a.setUpdated(b,!0)}),this.attachEvent("onAfterTaskDelete",function(b){a._ganttMode="tasks",a.setUpdated(b,!0,"deleted")}),this.attachEvent("onAfterLinkUpdate",function(b){a._ganttMode="links",a.setUpdated(b,!0)}),this.attachEvent("onAfterLinkAdd",function(b){a._ganttMode="links",a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterLinkDelete",function(b){a._ganttMode="links",a.setUpdated(b,!0,"deleted")}),this.attachEvent("onRowDragEnd",function(b,c){a._ganttMode="tasks",this.getTask(b).target=c,a.setUpdated(b,!0,"order")}),a.attachEvent("onBeforeDataSending",function(){return this.serverProcessor=this._serverProcessor+getUrlSymbol(this._serverProcessor)+"gantt_mode="+this._ganttMode,!0}),a._getRowData=dhtmlx.bind(function(b){var c;c="tasks"==a._ganttMode?this.isTaskExists(b)?this.getTask(b):{id:b}:this.isLinkExists(b)?this.getLink(b):{id:b};var d={};for(var e in c)if("$"!=e.substr(0,1)){var f=c[e];d[e]=f instanceof Date?this.templates.xml_format(f):f}return c.$no_start&&(c.start_date="",c.duration=""),c.$no_end&&(c.end_date="",c.duration=""),d[a.action_param]=this.getUserData(b,a.action_param),d},this),this._change_id=dhtmlx.bind(function(b,c){"tasks"!=a._ganttMode?this.changeLinkId(b,c):this.changeTaskId(b,c)},this),this._row_style=function(b,c){if("tasks"==a._ganttMode){var d=gantt.getTaskRowNode(b);if(d)if(c)d.className+=" "+c;else{var e=/ (gantt_updated|gantt_inserted|gantt_deleted|gantt_invalid|gantt_error)/g;d.className=d.className.replace(e,"")}}},this._delete_task=function(){},this._dp=a},gantt.getUserData=function(a,b){return this.userdata||(this.userdata={}),this.userdata[a]&&this.userdata[a][b]?this.userdata[a][b]:""},gantt.setUserData=function(a,b,c){this.userdata||(this.userdata={}),this.userdata[a]||(this.userdata[a]={}),this.userdata[a][b]=c},gantt._init_link=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a},gantt._sync_links=function(){for(var a in this._pull)this._pull[a].$source=[],this._pull[a].$target=[];for(var a in this._lpull){var b=this._lpull[a];this._pull[b.source]&&this._pull[b.source].$source.push(a),this._pull[b.target]&&this._pull[b.target].$target.push(a)}},gantt.getLink=function(a){return dhtmlx.assert(this._lpull[a],"Link doesn't exist"),this._lpull[a]},gantt.isLinkExists=function(a){return dhtmlx.defined(this._lpull[a])},gantt.addLink=function(a){return a=this._init_link(a),!1!==this.callEvent("onBeforeLinkAdd",[a.id,a])&&(this._lpull[a.id]=a,this._sync_links(),this._render_link(a.id),this.callEvent("onAfterLinkAdd",[a.id,a]),a.id)},gantt.updateLink=function(a,b){return dhtmlx.defined(b)||(b=this.getLink(a)),!1!==this.callEvent("onBeforeLinkUpdate",[a,b])&&(this._lpull[a]=b,this._sync_links(),this._render_link(a),this.callEvent("onAfterLinkUpdate",[a,b]),!0)},gantt.deleteLink=function(a){return this._deleteLink(a)},gantt._deleteLink=function(a,b){var c=this.getLink(a);return!(!b&&!1===this.callEvent("onBeforeLinkDelete",[a,c]))&&(delete this._lpull[a],this._sync_links(),this.refreshLink(a),b||this.callEvent("onAfterLinkDelete",[a,c]),!0)},gantt.changeLinkId=function(a,b){this._lpull[b]=this._lpull[a],this._lpull[b].id=b,delete this._lpull[a],this._sync_links(),this.callEvent("onLinkIdChange",[a,b])},gantt.getChildren=function(a){return dhtmlx.defined(this._branches[a])?this._branches[a]:[]},gantt.hasChild=function(a){return dhtmlx.defined(this._branches[a])},gantt.refreshData=function(){this._sync_order(),this._render_data()},gantt._configure=function(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c])},gantt._init_skin=function(){if(!gantt.skin)for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b].href.match("dhtmlxgantt_([a-z]+).css");if(c){gantt.skin=c[1];break}}gantt.skin||(gantt.skin="terrace");var d=gantt.skins[gantt.skin];this._configure(gantt.config,d.config);var e=gantt.config.columns;e[1]&&void 0===e[1].width&&(e[1].width=d._second_column_width),e[2]&&void 0===e[2].width&&(e[2].width=d._third_column_width),d._lightbox_template&&(gantt._lightbox_template=d._lightbox_template),gantt._init_skin=function(){}},gantt.skins={},gantt._lightbox_methods={},gantt._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>",gantt.showLightbox=function(a){if(a&&!this.config.readonly&&this.callEvent("onBeforeLightbox",[a])){var b=this.getTask(a),c=this.getLightbox(this._get_safe_type(b.type));this._center_lightbox(c),this.showCover(),this._fill_lightbox(a,c),this.callEvent("onLightbox",[a])}},gantt._get_timepicker_step=function(){if(this.config.round_dnd_dates){var a=gantt._tasks,b=this._get_line(a.unit)*a.step/60;return b>=1440&&(b=this.config.time_step),b}return this.config.time_step},gantt.getLabel=function(a,b){for(var c=this._get_typed_lightbox_config(),d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""},gantt.updateCollection=function(a,b){var b=b.slice(0),c=gantt.serverList(a);return!!c&&(c.splice(0,c.length),c.push.apply(c,b||[]),void gantt.resetLightbox())},gantt.getLightboxType=function(){return this._get_safe_type(this._lightbox_type)},gantt.getLightbox=function(a){if(void 0===a&&(a=this.getLightboxType()),!this._lightbox||this.getLightboxType()!=this._get_safe_type(a)){this._lightbox_type=this._get_safe_type(a);var b=document.createElement("DIV");b.className="dhx_cal_light";var c=this._is_lightbox_timepicker();(gantt.config.wide_form||c)&&(b.className+=" dhx_cal_light_wide"),c&&(gantt.config.wide_form=!0,b.className+=" dhx_cal_light_full"),b.style.visibility="hidden";var d=this._lightbox_template,e=this.config.buttons_left;for(var f in e)d+="<div class='dhx_btn_set dhx_left_btn_set "+e[f]+"_set'><div dhx_button='1' class='"+e[f]+"'></div><div>"+this.locale.labels[e[f]]+"</div></div>";e=this.config.buttons_right;for(var f in e)d+="<div class='dhx_btn_set dhx_right_btn_set "+e[f]+"_set' style='float:right;'><div dhx_button='1' class='"+e[f]+"'></div><div>"+this.locale.labels[e[f]]+"</div></div>";d+="</div>",b.innerHTML=d,gantt.config.drag_lightbox&&(b.firstChild.onmousedown=gantt._ready_to_dnd,b.firstChild.onselectstart=function(){return!1},b.firstChild.style.cursor="pointer",gantt._init_dnd_events()),document.body.insertBefore(b,document.body.firstChild),this._lightbox=b;var g=this._get_typed_lightbox_config(a);d=this._render_sections(g);for(var h=b.getElementsByTagName("div"),f=0;f<h.length;f++){var i=h[f];if("dhx_cal_larea"==i.className){i.innerHTML=d;break}}this.resizeLightbox(),this._init_lightbox_events(this),b.style.display="none",b.style.visibility="visible"}return this._lightbox},gantt._render_sections=function(a){for(var b="",c=0;c<a.length;c++){var d=this.form_blocks[a[c].type];if(d){a[c].id="area_"+dhtmlx.uid();var e=a[c].hidden?" style='display:none'":"",f="";a[c].button&&(f="<div class='dhx_custom_button' index='"+c+"'><div class='dhx_custom_button_"+a[c].button+"'></div><div>"+this.locale.labels["button_"+a[c].button]+"</div></div>"),this.config.wide_form&&(b+="<div class='dhx_wrap_section' "+e+">"),b+="<div id='"+a[c].id+"' class='dhx_cal_lsection'>"+f+this.locale.labels["section_"+a[c].name]+"</div>"+d.render.call(this,a[c]),b+="</div>"}}return b},gantt.resizeLightbox=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px",b.style.height=b.scrollHeight+"px",a.style.height=b.scrollHeight+this.config.lightbox_additional_height+"px",b.style.height=b.scrollHeight+"px"}},gantt._center_lightbox=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px",a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+(document.body.offsetWidth-a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}},gantt.showCover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="dhx_cal_cover";var a=void 0!==document.height?document.height:document.body.offsetHeight,b=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(a,b)+"px",document.body.appendChild(this._cover)}},gantt._init_lightbox_events=function(){gantt.lightbox_events={},gantt.lightbox_events.dhx_save_btn=function(){gantt._save_lightbox()},gantt.lightbox_events.dhx_delete_btn=function(){gantt.callEvent("onLightboxDelete",[gantt._lightbox_id])&&gantt.$click.buttons.delete(gantt._lightbox_id)},gantt.lightbox_events.dhx_cancel_btn=function(){gantt._cancel_lightbox()},gantt.lightbox_events.default=function(a,b){if(b.getAttribute("dhx_button"))gantt.callEvent("onLightboxButton",[b.className,b,a]);else{var c,d,e;-1!=b.className.indexOf("dhx_custom_button")&&(-1!=b.className.indexOf("dhx_custom_button_")?(c=b.parentNode.getAttribute("index"),e=b.parentNode.parentNode):(c=b.getAttribute("index"),e=b.parentNode,b=b.firstChild));var f=gantt._get_typed_lightbox_config();c&&(d=gantt.form_blocks[f[c].type],d.button_click(c,b,e,e.nextSibling))}},dhtmlxEvent(gantt.getLightbox(),"click",function(a){a=a||window.event;var b=a.target?a.target:a.srcElement
;if(b.className||(b=b.previousSibling),b&&b.className&&0===b.className.indexOf("dhx_btn_set")&&(b=b.firstChild),b&&b.className){return(dhtmlx.defined(gantt.lightbox_events[b.className])?gantt.lightbox_events[b.className]:gantt.lightbox_events.default)(a,b)}return!1}),gantt.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case gantt.keys.edit_save:if((a||event).shiftKey)return;gantt._save_lightbox();break;case gantt.keys.edit_cancel:gantt._cancel_lightbox()}}},gantt._cancel_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxCancel",[this._lightbox_id,a.$new]),a.$new&&(this._deleteTask(a.id,!0),this.refreshData()),this.hideLightbox()},gantt._save_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxSave",[this._lightbox_id,a,!!a.$new])&&(a.$new?(delete a.$new,this.addTask(a)):(dhtmlx.mixin(this.getTask(a.id),a,!0),this.updateTask(a.id)),this.refreshData(),this.hideLightbox())},gantt.getLightboxValues=function(){for(var a=dhtmlx.mixin({},this.getTask(this._lightbox_id)),b=this._get_typed_lightbox_config(),c=0;c<b.length;c++){var d=document.getElementById(b[c].id);d=d?d.nextSibling:d;var e=this.form_blocks[b[c].type],f=e.get_value.call(this,d,a,b[c]);"auto"!=b[c].map_to&&(a[b[c].map_to]=f)}return a},gantt.hideLightbox=function(){var a=this.getLightbox();a&&(a.style.display="none"),this._lightbox_id=null,this.hideCover(),this.callEvent("onAfterLightbox",[])},gantt.hideCover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},gantt.resetLightbox=function(){gantt._lightbox&&!gantt._custom_lightbox&&gantt._lightbox.parentNode.removeChild(gantt._lightbox),gantt._lightbox=null},gantt._set_lightbox_values=function(a,b){var c=a,d=b.getElementsByTagName("span");gantt.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=gantt.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.task_time(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.task_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var e=this._get_typed_lightbox_config(this.getLightboxType()),f=0;f<e.length;f++){var g=e[f];if(this.form_blocks[g.type]){var h=document.getElementById(g.id).nextSibling,i=this.form_blocks[g.type],j=dhtmlx.defined(c[g.map_to])?c[g.map_to]:g.default_value;i.set_value.call(this,h,j,c,g),g.focus&&i.focus.call(this,h)}}a.id&&(gantt._lightbox_id=a.id)},gantt._fill_lightbox=function(a,b){var c=this.getTask(a);this._set_lightbox_values(c,b)},gantt.getLightboxSection=function(a){var b=this._get_typed_lightbox_config(),c=0;for(c;c<b.length&&b[c].name!=a;c++);var d=b[c];this._lightbox||this.getLightbox();var e=document.getElementById(d.id),f=e.nextSibling,g={section:d,header:e,node:f,getValue:function(a){return this.form_blocks[d.type].get_value(f,a||{},d)},setValue:function(a,b){return this.form_blocks[d.type].set_value(f,a,b||{},d)}},h=this._lightbox_methods["get_"+d.type+"_control"];return h?h(g):g},gantt._lightbox_methods.get_template_control=function(a){return a.control=a.node,a},gantt._lightbox_methods.get_select_control=function(a){return a.control=a.node.getElementsByTagName("select")[0],a},gantt._lightbox_methods.get_textarea_control=function(a){return a.control=a.node.getElementsByTagName("textarea")[0],a},gantt._lightbox_methods.get_time_control=function(a){return a.control=a.node.getElementsByTagName("select"),a},gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd),dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd),gantt._init_dnd_events=function(){}},gantt._move_while_dnd=function(a){if(gantt._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var b=gantt.getLightbox(),c=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=gantt._lb_start[1]+c[1]-gantt._dnd_start_lb[1]+"px",b.style.left=gantt._lb_start[0]+c[0]-gantt._dnd_start_lb[0]+"px"}},gantt._ready_to_dnd=function(a){var b=gantt.getLightbox();gantt._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)],gantt._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]},gantt._finish_dnd=function(){gantt._lb_start&&(gantt._lb_start=gantt._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)},gantt._focus=function(a,b){a&&a.focus&&(gantt.config.touch||(b&&a.select&&a.select(),a.focus()))},gantt.form_blocks={getTimePicker:function(a,b){var c=a.time_format;if(!c){var c=["%d","%m","%Y"];gantt._get_line(gantt._tasks.unit)<gantt._get_line("day")&&c.push("%H:%i")}a._time_format_order={size:0};var d=this.config,e=this.date.date_part(new Date(gantt._min_date.valueOf())),f=1440,g=0;gantt.config.limit_time_select&&(f=60*d.last_hour+1,g=60*d.first_hour,e.setHours(d.first_hour));for(var h="",i=0;i<c.length;i++){var j=c[i];i>0&&(h+=" ");var k="";switch(j){case"%Y":a._time_format_order[2]=i,a._time_format_order.size++;for(var l=e.getFullYear()-5,m=0;10>m;m++)k+="<option value='"+(l+m)+"'>"+(l+m)+"</option>";break;case"%m":a._time_format_order[1]=i,a._time_format_order.size++;for(var m=0;12>m;m++)k+="<option value='"+m+"'>"+this.locale.date.month_full[m]+"</option>";break;case"%d":a._time_format_order[0]=i,a._time_format_order.size++;for(var m=1;32>m;m++)k+="<option value='"+m+"'>"+m+"</option>";break;case"%H:%i":var f=1440,g=0;a._time_format_order[3]=i,a._time_format_order.size++;var m=g,n=e.getDate();for(a._time_values=[];f>m;){k+="<option value='"+m+"'>"+this.templates.time_picker(e)+"</option>",a._time_values.push(m),e.setTime(e.valueOf()+60*this._get_timepicker_step()*1e3);m=24*(e.getDate()!=n?1:0)*60+60*e.getHours()+e.getMinutes()}}if(k){h+="<select "+(a.readonly?"disabled='disabled'":"")+(b?" style='display:none'":"")+">"+k+"</select>"}}return h},_fill_lightbox_select:function(a,b,c,d){if(a[b+d[0]].value=c.getDate(),a[b+d[1]].value=c.getMonth(),a[b+d[2]].value=c.getFullYear(),dhtmlx.defined(d[3])){var e=60*c.getHours()+c.getMinutes();e=Math.round(e/gantt._get_timepicker_step())*gantt._get_timepicker_step(),a[b+d[3]].value=e}},template:{render:function(a){return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+(a.height||"30")+"px;'></div>"},set_value:function(a,b){a.innerHTML=b||""},get_value:function(a){return a.innerHTML||""},focus:function(){}},textarea:{render:function(a){return"<div class='dhx_cal_ltext' style='height:"+(a.height||"130")+"px;'><textarea></textarea></div>"},set_value:function(a,b){a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},select:{render:function(a){for(var b=(a.height||"23")+"px",c="<div class='dhx_cal_ltext' style='height:"+b+";'><select style='width:100%;'>",d=0;d<a.options.length;d++)c+="<option value='"+a.options[d].key+"'>"+a.options[d].label+"</option>";return c+="</select></div>"},set_value:function(a,b,c,d){var e=a.firstChild;!e._dhx_onchange&&d.onchange&&(e.onchange=d.onchange,e._dhx_onchange=!0),void 0===b&&(b=(e.options[0]||{}).value),e.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},time:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a),c=["<div style='height:30px;padding-top:0px;font-size:inherit;text-align:center;' class='dhx_section_time'>"];return c.push(b),a.single_date?(b=this.form_blocks.getTimePicker.call(this,a,!0),c.push("<span></span>")):c.push("<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"),c.push(b),c.push("</div>"),c.join("")},set_value:function(a,b,c,d){var e=this.config,f=a.getElementsByTagName("select"),g=d._time_format_order;if(d._time_format_size,e.auto_end_date)for(var h=function(){var a=new Date(f[g[2]].value,f[g[1]].value,f[g[0]].value,0,0),b=gantt.calculateEndDate(a,1);this.form_blocks._fill_lightbox_select(f,g.size,b,g,e)},i=0;4>i;i++)f[i].onchange=h;this.form_blocks._fill_lightbox_select(f,0,c.start_date,g,e),this.form_blocks._fill_lightbox_select(f,g.size,c.end_date,g,e)},get_value:function(a,b,c){var d=a.getElementsByTagName("select"),e=c._time_format_order,f=0,g=0;if(dhtmlx.defined(e[3])){var h=parseInt(d[e[3]].value,10);f=Math.floor(h/60),g=h%60}if(b.start_date=new Date(d[e[2]].value,d[e[1]].value,d[e[0]].value,f,g),f=g=0,dhtmlx.defined(e[3])){var h=parseInt(d[e.size+e[3]].value,10);f=Math.floor(h/60),g=h%60}return b.end_date=new Date(d[e[2]+e.size].value,d[e[1]+e.size].value,d[e[0]+e.size].value,f,g),b.end_date<=b.start_date&&(b.end_date=gantt.date.add(b.start_date,gantt._get_timepicker_step(),"minute")),{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},duration:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a);b="<div class='dhx_time_selects'>"+b+"</div>";var c=this.locale.labels[this.config.duration_unit+"s"],d=a.single_date?' style="display:none"':"",e=a.readonly?" disabled='disabled'":"";return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+b+" <div class='dhx_gantt_duration' "+d+"><input type='button' class='dhx_gantt_duration_dec' value='-'"+e+"><input type='text' value='5' class='dhx_gantt_duration_value'"+e+"><input type='button' class='dhx_gantt_duration_inc' value='+'"+e+"> "+c+" <span></span></div></div>"},set_value:function(a,b,c,d){function e(){var b=gantt.form_blocks.duration._get_start_date.call(gantt,a,d),c=gantt.form_blocks.duration._get_duration.call(gantt,a,d),e=gantt.calculateEndDate(b,c);l.innerHTML=gantt.templates.task_date(e)}function f(a){var b=j.value;b=parseInt(b,10),window.isNaN(b)&&(b=0),b+=a,1>b&&(b=1),j.value=b,e()}var g=this.config,h=a.getElementsByTagName("select"),i=a.getElementsByTagName("input"),j=i[1],k=[i[0],i[2]],l=a.getElementsByTagName("span")[0],m=d._time_format_order;k[0].onclick=dhtmlx.bind(function(){f(-1*this.config.duration_step)},this),k[1].onclick=dhtmlx.bind(function(){f(1*this.config.duration_step)},this),h[0].onchange=e,h[1].onchange=e,h[2].onchange=e,h[3]&&(h[3].onchange=e),j.onkeydown=dhtmlx.bind(function(a){a=a||window.event;var b=a.charCode||a.keyCode||a.which;return 40==b?(f(-1*this.config.duration_step),!1):38==b?(f(1*this.config.duration_step),!1):void window.setTimeout(function(){e()},1)},this),j.onchange=dhtmlx.bind(function(){e()},this),this.form_blocks._fill_lightbox_select(h,0,c.start_date,m,g);var n;n=c.end_date?gantt.calculateDuration(c.start_date,c.end_date):c.duration,n=Math.round(n),j.value=n,e()},_get_start_date:function(a,b){var c=a.getElementsByTagName("select"),d=b._time_format_order,e=0,f=0;if(dhtmlx.defined(d[3])){var g=parseInt(c[d[3]].value,10);e=Math.floor(g/60),f=g%60}return new Date(c[d[2]].value,c[d[1]].value,c[d[0]].value,e,f)},_get_duration:function(a){var b=a.getElementsByTagName("input")[1];return b=parseInt(b.value,10),window.isNaN(b)&&(b=1),0>b&&(b*=-1),b},get_value:function(a,b,c){b.start_date=this.form_blocks.duration._get_start_date(a,c);var d=this.form_blocks.duration._get_duration(a,c);return b.end_date=this.calculateEndDate(b.start_date,d),b.duration=d,{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},typeselect:{render:function(a){var b=gantt.config.types,c=gantt.locale.labels,d=[];for(var e in b)d.push({key:b[e],label:c["type_"+e]});a.options=d;var f=a.onchange;return a.onchange=function(){gantt.getState().lightbox,gantt.changeLightboxType(this.value),"function"==typeof f&&f.apply(this,arguments)},gantt.form_blocks.select.render.apply(this,arguments)},set_value:function(){return gantt.form_blocks.select.set_value.apply(this,arguments)},get_value:function(){return gantt.form_blocks.select.get_value.apply(this,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(this,arguments)}},parent:{_filter:function(a,b,c){var d=b.filter||function(){return!0};a=a.slice(0);for(var e=0;e<a.length;e++){var f=a[e];(f.id==c||gantt.isChildOf(f.id,c)||!1===d(f.id,f))&&(a.splice(e,1),e--)}return a},_display:function(a,b){var c=[],d=[];b&&(c=gantt.getTaskByTime(),a.allow_root&&c.unshift({id:gantt.config.root_id,text:a.root_label||""}),c=this._filter(c,a,b),a.sort&&c.sort(a.sort));for(var e=a.template||gantt.templates.task_text,f=0;f<c.length;f++){var g=e.apply(gantt,[c[f].start_date,c[f].end_date,c[f]]);void 0===g&&(g=""),d.push({key:c[f].id,label:g})}return a.options=d,a.map_to=a.map_to||"parent",gantt.form_blocks.select.render.apply(this,arguments)},render:function(a){return gantt.form_blocks.parent._display(a,!1)},set_value:function(a,b,c,d){var e=document.createElement("div");e.innerHTML=gantt.form_blocks.parent._display(d,c.id);var f=e.removeChild(e.firstChild);return a.onselect=null,a.parentNode.replaceChild(f,a),gantt.form_blocks.select.set_value.apply(this,[f,b,c,d])},get_value:function(){return gantt.form_blocks.select.get_value.apply(this,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(this,arguments)}}},gantt._is_lightbox_timepicker=function(){for(var a=this._get_typed_lightbox_config(),b=0;b<a.length;b++)if("time"==a[b].name&&"time"==a[b].type)return!0;return!1},gantt._dhtmlx_confirm=function(a,b,c,d){if(!a)return c();var e={text:a};b&&(e.title=b),d&&(e.ok=d),c&&(e.callback=function(a){a&&c()}),dhtmlx.confirm(e)},gantt._get_typed_lightbox_config=function(a){void 0===a&&(a=this.getLightboxType());var b=this._get_type_name(a);return gantt.config.lightbox[b+"_sections"]?gantt.config.lightbox[b+"_sections"]:gantt.config.lightbox.sections},gantt._silent_redraw_lightbox=function(a){var b=this.getLightboxType();if(this.getState().lightbox){var c=this.getState().lightbox,d=this.getLightboxValues(),e=dhtmlx.copy(this.getTask(c));this.resetLightbox();var f=dhtmlx.mixin(e,d,!0),g=this.getLightbox(a||void 0);this._set_lightbox_values(f,g),this._center_lightbox(this.getLightbox()),this.callEvent("onLightboxChange",[b,this.getLightboxType()])}else this.resetLightbox(),this.getLightbox(a||void 0);this.callEvent("onLightboxChange",[b,this.getLightboxType()])},dataProcessor.prototype={setTransactionMode:function(a,b){this._tMode=a,this._tSend=b},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=convertStringToBoolean(a)},setDataColumns:function(a){this._columns="string"==typeof a?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=convertStringToBoolean(a)},enablePartialDataSend:function(a){this._changed=convertStringToBoolean(a)},setUpdateMode:function(a,b){this.autoUpdate="cell"==a,this.updateMode=a,this.dnd=b},ignore:function(a,b){this._silent_mode=!0,a.call(b||window),this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a);c=c||"updated";var e=this.obj.getUserData(a,this.action_param);e&&"updated"==c&&(c=e),b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,this.action_param,"")),b||this._clearUpdateFlag(a),this.markRow(a,b,c),b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);if(e&&(d=this.styles[e],b=!0),this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(var f=0;f<e.details.length;f++)e.details[f]&&this.obj[this._methods[1]](a,f,d)}},getState:function(a){return this.obj.getUserData(a,this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}}),this._invalid[a]=b},checkBeforeUpdate:function(){return!0},sendData:function(a){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),void 0===a||this._tSend?this.sendAllData():!this._in_progress[a]&&(this.messages=[],!(!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",[a,this.messages]))&&void this._beforeSendData(this._getRowData(a),a))):void 0},_beforeSendData:function(a,b){return!!this.callEvent("onBeforeUpdate",[b,this.getState(b),a])&&void this._sendData(a,b)},serialize:function(a,b){if("string"==typeof a)return a;if(void 0!==b)return this.serialize_one(a,"");var c=[],d=[];for(var e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));return c.push("ids="+this.escape(d.join(","))),dhtmlx.security_key&&c.push("dhx_security="+dhtmlx.security_key),c.join("&")},serialize_one:function(a,b){if("string"==typeof a)return a;var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(this.escape((b||"")+d)+"="+this.escape(a[d]));return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());var c=new dtmlXMLLoaderObject(this.afterUpdate,this,!0),d=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");"POST"!=this._tMode?c.loadXML(d+(-1!=d.indexOf("?")?"&":"?")+this.serialize(a,b)):c.loadXML(d,!0,this.serialize(a,b)),this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]){if(this.is_invalid(this.updatedRows[b]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(){for(var a={},b=!1,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];this._in_progress[d]||this.is_invalid(d)||this.callEvent("onBeforeUpdate",[d,this.getState(d)])&&(a[d]=this._getRowData(d,d+this.post_delim),b=!0,this._in_progress[d]=(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return""!==a}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){var b=0;for(b=0;b<this.updatedRows.length&&a!=this.updatedRows[b];b++);return b},defineAction:function(a,b){this._uActions||(this._uActions=[]),this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f="error"!=c&&"invalid"!=c;if(f||this.set_invalid(a,c),this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];"wait"!=this._in_progress[e]&&this.setUpdated(a,!1);var g=a;switch(c){case"inserted":case"insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case"delete":case"deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}"wait"!=this._in_progress[e]?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,this.action_param))),this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c,d,e){if(e.getXMLTopNode("data"),e.xmlDoc.responseXML){for(var f=e.doXPath("//data/action"),g=0;g<f.length;g++){var h=f[g],i=h.getAttribute("type"),j=h.getAttribute("sid"),k=h.getAttribute("tid");a.afterUpdateCallback(j,k,i,h)}a.finalizeUpdate()}},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2e3,this._user=b||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(a,b,c,d){this.afterAutoUpdate(a,b,c,d)}),this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b){return"collision"!=b||(this._need_update=!0,!1)},fullSync:function(){return!0===this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(a,b){return!this._update_busy&&(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=b,void this._loader.loadXML(a))},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),c=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&");c=c.replace("editing=true&",""),this.getUpdates(c,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));var c=a._loader.doXPath("//update");if(c.length){a._silent_mode=!0;for(var d=0;d<c.length;d++){var e=c[d].getAttribute("status"),f=c[d].getAttribute("id"),g=c[d].getAttribute("parent");switch(e){case"inserted":a.callEvent("insertCallback",[c[d],f,g]);break;case"updated":a.callEvent("updateCallback",[c[d],f,g]);break;case"deleted":a.callEvent("deleteCallback",[c[d],f,g])}}a._silent_mode=!1}a._update_busy=!1,a=null})}},dhtmlx.assert=function(a,b){a||dhtmlx.message({type:"error",text:b,expire:-1})},gantt.init=function(a,b,c){b&&c&&(this.config.start_date=this._min_date=new Date(b),this.config.end_date=this._max_date=new Date(c)),this._init_skin(),this.config.scroll_size||(this.config.scroll_size=this._detectScrollSize()),this._reinit(a),this.attachEvent("onLoadEnd",this.render),dhtmlxEvent(window,"resize",this._on_resize),this.init=function(a){this.$container&&(this.$container.innerHTML=""),this._reinit(a)},this.callEvent("onGanttReady",[])},gantt._reinit=function(a){this._init_html_area(a),this._set_sizes(),this._task_area_pulls={},this._task_area_renderers={},this._init_touch_events(),this._init_templates(),this._init_grid(),this._init_tasks(),this.render(),this._set_scroll_events(),dhtmlxEvent(this.$container,"click",this._on_click),dhtmlxEvent(this.$container,"dblclick",this._on_dblclick),dhtmlxEvent(this.$container,"mousemove",this._on_mousemove),dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu)},gantt._init_html_area=function(a){this._obj="string"==typeof a?document.getElementById(a):a,dhtmlx.assert(this._obj,"Invalid html container: "+a);var b="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div>";b+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>",this._obj.innerHTML=b,this.$container=this._obj.firstChild;var c=this.$container.childNodes;this.$grid=c[0],this.$task=c[1],this.$scroll_ver=c[2],this.$scroll_hor=c[3],this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>",this.$grid_scale=this.$grid.childNodes[0],this.$grid_data=this.$grid.childNodes[1],this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>",this.$task_scale=this.$task.childNodes[0],this.$task_data=this.$task.childNodes[1],this.$task_bg=this.$task_data.childNodes[0],this.$task_links=this.$task_data.childNodes[1],this.$task_bars=this.$task_data.childNodes[2]},gantt.$click={buttons:{edit:function(a){gantt.showLightbox(a)},delete:function(a){var b=gantt.locale.labels.confirm_deleting,c=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(b,c,function(){gantt.getTask(a).$new?(gantt._deleteTask(a,!0),gantt.refreshData()):gantt.deleteTask(a),gantt.hideLightbox()})}}},gantt._calculate_content_height=function(){var a=this.config.scale_height,b=this._order.length*this.config.row_height,c=this._scroll_hor?this.config.scroll_size+1:0;return this._is_grid_visible()||this._is_chart_visible()?a+b+2+c:0},gantt._calculate_content_width=function(){var a=this._get_grid_width(),b=this._tasks?this._tasks.full_width:0;return this._scroll_ver&&this.config.scroll_size,this._is_chart_visible()||(b=0),this._is_grid_visible()||(a=0),a+b+1},gantt._get_resize_options=function(){var a={x:!1,y:!1};return"xy"==this.config.autosize?a.x=a.y=!0:"y"==this.config.autosize||!0===this.config.autosize?a.y=!0:"x"==this.config.autosize&&(a.x=!0),a},gantt._set_sizes=function(){var a=this._get_resize_options();if(a.y&&(this._obj.style.height=this._calculate_content_height()+"px"),a.x&&(this._obj.style.width=this._calculate_content_width()+"px"),this._y=this._obj.clientHeight,!(this._y<20)){this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";var b=Math.max(this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2,0);this.$grid_data.style.height=this.$task_data.style.height=b+"px";var c=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=c+"px",this.$grid.style.display=0===c?"none":"",this._x=this._obj.clientWidth,this._x<20||(this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px",this.$task.style.width=Math.max(this._x-this._get_grid_width()-2,0)+"px")}},gantt.getScrollState=function(){return{x:this.$task.scrollLeft,y:this.$task_data.scrollTop}},gantt.scrollTo=function(a,b){1*a==a&&(this.$task.scrollLeft=a),1*b==b&&(this.$task_data.scrollTop=b,this.$grid_data.scrollTop=b)},gantt.showDate=function(a){var b=this.posFromDate(a),c=Math.max(b-this.config.task_scroll_offset,0);this.scrollTo(c)},gantt.showTask=function(a){var b=this.getTaskNode(a);if(b){var c=Math.max(b.offsetLeft-this.config.task_scroll_offset,0),d=b.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this.scrollTo(c,d)}},gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes(),gantt._scroll_resize()},gantt.render=function(){if(this._render_grid(),this._render_tasks_scales(),this._scroll_resize(),this._on_resize(),this._render_data(),this.config.initial_scroll){var a=this._order[0]||this.config.root_id;a&&this.showTask(a)}this.callEvent("onGanttRender",[])},gantt._set_scroll_events=function(){dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_hor.scrollLeft;gantt.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=a,gantt.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=gantt.$task.scrollLeft;gantt.$scroll_hor.scrollLeft!=a&&(gantt.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=gantt.$task_data.scrollTop;gantt.$scroll_ver.scrollTop!=a&&(gantt.$scroll_ver.scrollTop=a)}),dhtmlxEvent(gantt.$container,"mousewheel",function(a){var b=gantt._get_resize_options();if(a.wheelDeltaX){if(b.x)return!0;var c=a.wheelDeltaX/-40,d=gantt.$task.scrollLeft+30*c;gantt.scrollTo(d,null),gantt.$scroll_hor.scrollTop=e}else{if(b.y)return!0;var c=a.wheelDelta/-40;void 0===a.wheelDelta&&(c=a.detail);var e=gantt.$grid_data.scrollTop+30*c;gantt.scrollTo(null,e),gantt.$scroll_ver.scrollTop=e}return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1})},gantt._scroll_resize=function(){if(!(this._x<20||this._y<20)){var a=this._get_grid_width(),b=this._x-a,c=this._y-this.config.scale_height,d=this.config.scroll_size+1,e=this.$task_data.offsetWidth-d,f=this.config.row_height*this._order.length,g=this._get_resize_options(),h=this._scroll_hor=!g.x&&e>b,i=this._scroll_ver=!g.y&&f>c;this.$scroll_hor.style.display=h?"block":"none",this.$scroll_hor.style.height=(h?d:0)+"px",this.$scroll_hor.style.width=this._x-(i?d:2)+"px",this.$scroll_hor.firstChild.style.width=e+a+d+2+"px",this.$scroll_ver.style.display=i?"block":"none",this.$scroll_ver.style.width=(i?d:0)+"px",this.$scroll_ver.style.height=this._y-(h?d:0)-this.config.scale_height+"px",this.$scroll_ver.style.top=this.config.scale_height+"px",this.$scroll_ver.firstChild.style.height=this.config.scale_height+f+"px"}},gantt.locate=function(a){var b=gantt._get_target_node(a);if("gantt_task_cell"==b.className)return null;for(var c=arguments[1]||this.config.task_attribute;b;){if(b.getAttribute){var d=b.getAttribute(c);if(d)return d}b=b.parentNode}return null},gantt._get_target_node=function(a){var b;return a.tagName?b=a:(a=a||window.event,b=a.target||a.srcElement),b},gantt._trim=function(a){return(String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")}).apply(a)},gantt._locate_css=function(a,b,c){void 0===c&&(c=!0);for(var d=gantt._get_target_node(a),e="";d;){if(e=d.className){var f=e.indexOf(b);if(f>=0){if(!c)return d;var g=0===f||!gantt._trim(e.charAt(f-1)),h=f+b.length>=e.length||!gantt._trim(e.charAt(f+b.length));if(g&&h)return d}}d=d.parentNode}return null},gantt._locateHTML=function(a,b){var c=gantt._get_target_node(a);for(b=b||this.config.task_attribute;c;){if(c.getAttribute){if(c.getAttribute(b))return c}c=c.parentNode}return null},gantt.getTaskRowNode=function(a){for(var b=this.$grid_data.childNodes,c=this.config.task_attribute,d=0;d<b.length;d++)if(b[d].getAttribute){var e=b[d].getAttribute(c);if(e==a)return b[d]}return null},gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:new Date(this._min_date),max_date:new Date(this._max_date),lightbox:this._lightbox_id}},gantt._checkTimeout=function(a,b){if(!b)return!0;var c=1e3/b;return 1>c||!a._on_timeout&&(setTimeout(function(){delete a._on_timeout},c),a._on_timeout=!0,!0)},gantt.selectTask=function(a){if(!this.config.select_task)return!1;if(a){if(this._selected_task==a)return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[a]))return!1;this.unselectTask(),this._selected_task=a,this.refreshTask(a),this.callEvent("onTaskSelected",[a])}return this._selected_task},gantt.unselectTask=function(){var a=this._selected_task;a&&(this._selected_task=null,this.refreshTask(a),this.callEvent("onTaskUnselected",[a]))},gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null},gantt.changeLightboxType=function(a){return this.getLightboxType()==a||void gantt._silent_redraw_lightbox(a)},gantt.date={init:function(){for(var a=gantt.locale.date.month_short,b=gantt.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;for(var a=gantt.locale.date.month_full,b=gantt.locale.date.month_full_hash={},c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.getHours()&&a.setTime(a.getTime()+36e5*(24-a.getHours())),a},time_part:function(a){return(a.valueOf()/1e3-60*a.getTimezoneOffset())%86400},week_start:function(a){var b=a.getDay();return gantt.config.start_on_monday&&(0===b?b=6:b--),this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){return a.setDate(1),this.date_part(a)},year_start:function(a){return a.setMonth(0),this.month_start(a)},day_start:function(a){return this.date_part(a)},hour_start:function(a){var b=a.getHours();return this.day_start(a),a.setHours(b),a},minute_start:function(a){var b=a.getMinutes();return this.hour_start(a),a.setMinutes(b),a},_add_days:function(a,b){var c=new Date(a.valueOf());return c.setDate(c.getDate()+b),!a.getHours()&&c.getHours()&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case"day":d=gantt.date._add_days(d,b);break;case"week":
d=gantt.date._add_days(d,7*b);break;case"month":d.setMonth(d.getMonth()+b);break;case"year":d.setYear(d.getFullYear()+b);break;case"hour":d.setTime(d.getTime()+60*b*60*1e3);break;case"minute":d.setTime(d.getTime()+60*b*1e3);break;default:return gantt.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return 10>a?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){return a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return'"+gantt.date.to_fixed(date.getDate())+"';case"%m":return'"+gantt.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+gantt.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+gantt.locale.date.day_short[date.getDay()]+"';case"%l":return'"+gantt.locale.date.day_full[date.getDay()]+"';case"%M":return'"+gantt.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+gantt.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+gantt.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+gantt.date.to_fixed(date.getHours())+"';case"%i":return'"+gantt.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+gantt.date.to_fixed(date.getSeconds())+"';case"%W":return'"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+"';default:return a}}),b&&(a=a.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case"%j":case"%d":c+="set[2]=temp["+e+"]||1;";break;case"%n":case"%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case"%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":c+="set[3]=temp["+e+"]||0;";break;case"%i":c+="set[4]=temp["+e+"]||0;";break;case"%Y":c+="set[0]=temp["+e+"]||0;";break;case"%a":case"%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":c+="set[5]=temp["+e+"]||0;";break;case"%M":c+="set[1]=gantt.locale.date.month_short_hash[temp["+e+"]]||0;";break;case"%F":c+="set[1]=gantt.locale.date.month_full_hash[temp["+e+"]]||0;"}var f="set[0],set[1],set[2],set[3],set[4],set[5]";return b&&(f=" Date.UTC("+f+")"),new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+f+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();0===b&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));var d=c.getFullYear(),e=Math.round((c.getTime()-new Date(d,0,1).getTime())/864e5);return 1+Math.floor(e/7)},getUTCISOWeek:function(a){return this.getISOWeek(a)},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())},parseDate:function(a,b){return"string"==typeof a&&(dhtmlx.defined(b)&&(b="string"==typeof b?dhtmlx.defined(gantt.templates[b])?gantt.templates[b]:gantt.date.str_to_date(b):gantt.templates.xml_date),a=b(a)),a}},gantt.config||(gantt.config={}),gantt.config||(gantt.config={}),gantt.templates||(gantt.templates={}),function(){dhtmlx.mixin(gantt.config,{links:{finish_to_start:"0",start_to_start:"1",finish_to_finish:"2",start_to_finish:"3"},types:{task:"task",project:"project",milestone:"milestone"},duration_unit:"day",work_time:!1,correct_work_time:!1,skip_off_time:!1,autosize:!1,show_links:!0,show_task_cells:!0,show_chart:!0,show_grid:!0,min_duration:36e5,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:!0,server_utc:!1,show_progress:!0,fit_tasks:!1,select_task:!0,readonly:!1,date_grid:"%Y-%m-%d",drag_links:!0,drag_progress:!0,drag_resize:!0,drag_move:!0,drag_mode:{resize:"resize",progress:"progress",move:"move",ignore:"ignore"},round_dnd_dates:!0,link_wrapper_width:20,root_id:0,autofit:!0,columns:[{name:"text",tree:!0,width:"*"},{name:"task_title",tree:!0,width:"*"},{name:"start_date",align:"center"},{name:"duration",align:"center"},{name:"add",width:"44"}],step:1,scale_unit:"day",subscales:[],time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"task_title",height:40,map_to:"text",type:"textarea",focus:!0},{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"task_title",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",height:72,type:"duration",readonly:!0,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"task_title",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",height:72,type:"duration",single_date:!0,map_to:"auto"}]},drag_lightbox:!0,sort:!1,details_on_create:!0,details_on_dblclick:!0,initial_scroll:!0,task_scroll_offset:100,task_height:"full",min_column_width:70}),gantt.keys={edit_save:13,edit_cancel:27},gantt._init_template=function(a,b){var c=this._reg_templates||{};this.config[a]&&c[a]!=this.config[a]&&(b&&this.templates[a]||(this.templates[a]=this.date.date_to_str(this.config[a]),c[a]=this.config[a])),this._reg_templates=c},gantt._init_templates=function(){var a=gantt.locale.labels;a.dhx_save_btn=a.icon_save,a.dhx_cancel_btn=a.icon_cancel,a.dhx_delete_btn=a.icon_delete;var b=this.date.date_to_str,c=this.config;gantt._init_template("date_scale",!0),gantt._init_template("date_grid",!0),gantt._init_template("task_date",!0),dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(c.xml_date,c.server_utc),xml_format:b(c.xml_date,c.server_utc),api_date:this.date.str_to_date(c.api_date),progress_text:function(){return""},grid_header_class:function(){return""},task_text:function(a,b,c){return c.text},task_class:function(){return""},grid_row_class:function(){return""},task_row_class:function(){return""},task_cell_class:function(){return""},scale_cell_class:function(){return""},scale_row_class:function(){return""},grid_indent:function(){return"<div class='gantt_tree_indent'></div>"},grid_folder:function(a){return"<div class='gantt_tree_icon gantt_folder_"+(a.$open?"open":"closed")+"'></div>"},grid_file:function(){return"<div class='gantt_tree_icon gantt_file'></div>"},grid_open:function(a){return"<div class='gantt_tree_icon gantt_"+(a.$open?"close":"open")+"'></div>"},grid_blank:function(){return"<div class='gantt_tree_icon gantt_blank'></div>"},task_time:function(a,b){return gantt.templates.task_date(a)+" - "+gantt.templates.task_date(b)},time_picker:b(c.time_picker),link_class:function(){return""},link_description:function(a){var b=gantt.getTask(a.source),c=gantt.getTask(a.target);return"<b>"+b.text+"</b> &ndash;  <b>"+c.text+"</b>"},drag_link:function(a,b,c,d){a=gantt.getTask(a);var e=gantt.locale.labels,f="<b>"+a.text+"</b> "+(b?e.link_start:e.link_end)+"<br/>";return c&&(c=gantt.getTask(c),f+="<b> "+c.text+"</b> "+(d?e.link_start:e.link_end)+"<br/>"),f},drag_link_class:function(a,b,c,d){var e="";if(a&&c){e=" "+(gantt.isLinkAllowed(a,c,b,d)?"gantt_link_allow":"gantt_link_deny")}return"gantt_link_tooltip"+e}}),this.callEvent("onTemplatesReady",[])}}(),window.jQuery&&function(a){var b=[];a.fn.dhx_gantt=function(c){if("string"!=typeof(c=c||{})){var d=[];return this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxgantt")){for(var a in c)"data"!=a&&(gantt.config[a]=c[a]);gantt.init(this),c.data&&gantt.parse(c.data),d.push(gantt)}}),1===d.length?d[0]:d}return b[c]?b[c].apply(this,[]):void a.error("Method "+c+" does not exist on jQuery.dhx_gantt")}}(jQuery),window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b){var c=document.createElement("DIV");c.id="gantt_"+dhtmlx.uid(),c.style.width="100%",c.style.height="100%",c.cmp="grid",document.body.appendChild(c),this.attachObject(c.id);var d=this.vs[this.av];d.grid=gantt,gantt.init(c.id,a,b),c.firstChild.style.border="none",d.gridId=c.id,d.gridObj=c;return this.vs[this._viewRestore()].grid}),gantt.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{new_task:"New task",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Task will be deleted permanently, are you sure?",section_description:"Description",section_title:"Task Title",description:"Task Title",section_time:"Time period",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,task_height:24,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80},gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,task_height:24,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80},gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,task_height:24,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70},gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,task_height:24,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span><div class='dhx_cancel_btn'></div></div><div class='dhx_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{dhx_delete_btn:"icon_delete",dhx_save_btn:"icon_save"}},gantt.config.touch_drag=50,gantt.config.touch=!0,gantt._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||a.pointerType==a.MSPOINTER_TYPE_MOUSE}):this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&a.touches.length>1?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY}:a},function(){return!1}))},gantt._touch_events=function(a,b,c){function d(a){return a&&a.preventDefault&&a.preventDefault(),(a||event).cancelBubble=!0,!1}var e,f=0,g=!1,h=!1,i=null;this._gantt_touch_event_ready||(this._gantt_touch_event_ready=1,dhtmlxEvent(document.body,a[0],function(a){if(!c(a)&&g){var j=b(a);if(j&&i){var k=i.pageX-j.pageX,l=i.pageY-j.pageY;!h&&(Math.abs(k)>5||Math.abs(l)>5)&&(gantt._touch_scroll_active=h=!0,f=0,e=gantt.getScrollState()),h&&gantt.scrollTo(e.x+k,e.y+l)}return d(a)}})),dhtmlxEvent(this.$container,"contextmenu",function(a){return g?d(a):void 0}),dhtmlxEvent(this.$container,a[1],function(a){if(!c(a)){if(a.touches&&a.touches.length>1)return void(g=!1);if(g=!0,(i=b(a))&&f){var e=new Date;500>e-f?(gantt._on_dblclick(i),d(a)):f=e}else f=new Date}}),dhtmlxEvent(this.$container,a[2],function(a){c(a)||(gantt._touch_scroll_active=g=h=!1)})};